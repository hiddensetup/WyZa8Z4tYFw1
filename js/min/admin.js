"use strict";function showContent(){var t=document.getElementById("overlay"),e=document.documentElement;t.style.display="none",e.style.animation="fade-in .1s ease-in"}function initLoadingAnimation(){var t=document.getElementById("overlay");document.getElementById("loader");t.style.animation="load 1.6s ease-out",t.addEventListener("animationend",function(){showContent()})}function ExtraButton(){document.getElementById("CstBtn").classList.toggle("show")}!function(S){var d,i,_,j,y,G,P,q,O,u,p,H,o,l,h,r,g,f,b,V,z,v,W,m,X,x,J,Y,Z,s,Q,n,K,w=[],tt=!1,et=!1,B=!1,at=1,st=1,k={},it=1,nt=1,C=S(window).width()<555,e={last:0,header:!0,always_hidden:!1},ot="localhost"===location.hostname||"127.0.0.1"===location.hostname,rt=new Date,lt=!1,ct=!0,dt=!1,ut="undefined",c=!1,pt=!1,ht=!1,gt=["Abierto","Presupuesto","Consulta","Contactado","Visitado","Calificado","Confirmado","Pendiente","Resuelto","Pagado","VIP","Descartado","NA"];function A(t,e=!1){var a=d.find(".sb-info-card");e?"error"===e?(a.addClass("sb-info-card-error"),s=setTimeout(()=>{a.sbActive(!1)},4e3)):"warning"===e?(a.addClass("sb-info-card-warning"),s=setTimeout(()=>{a.sbActive(!1)},3e3)):a.addClass("sb-info-card-info"):(a.removeClass("sb-info-card-error sb-info-card-warning sb-info-card-info"),clearTimeout(s),s=setTimeout(()=>{a.sbActive(!1)},1500)),a.html(`<h3>${I(t)}</h3>`).sbActive(!0)}function T(t){if(typeof t==ut)return window.sb_current_user;window.sb_current_user=t}function $(t,e,a=!1,s="",i="",n=!1){let o=d.find(".sb-dialog-box").attr("data-type",e);var r=o.find("p");o.attr("id",s).setClass("sb-scroll-area",n).css("height",n?parseInt(S(window).height())-200+"px":""),o.find(".sb-title").html(i),r.html(("alert"==e?'<strong style="font-size: var(--chat-text-size-1-1);color: var(--chat-text-primary">'+I("Are you sure?")+"</strong> ":"")+I(t)),o.sbActive(!0).css({"margin-top":o.outerHeight()/-2+"px","margin-left":o.outerWidth()/-2+"px"}),K.sbActive(!0),Q=a,setTimeout(()=>{U.open_popup=o},500)}function F(t=!1,e=!0){d.find(".sb-loading-global").sbActive(t),e&&(K.sbActive(t),S("body").setClass("sb-lightbox-active",t))}function L(t){if(S(t).sbLoading())return 1;S(t).sbLoading(!0)}function I(t){return SB_TRANSLATIONS&&t in SB_TRANSLATIONS?SB_TRANSLATIONS[t]:t}function ft(t,e){var a=(t=S(t)).find("> div, > ul");a.css({height:"","max-height":""}),t.hasClass("sb-collapse")&&S(a).prop("scrollHeight")>e&&(t.sbActive(!0).attr("data-height",e),t.find(".bi-chevron-down").remove(),t.append(`<a class="sb-btn-text bi-chevron-down">${I("View more")}</a>`),a.css({height:e+"px","max-height":e+"px"}))}function bt(t,e){let a=S(t).parent().find("i"),s=S(t).val();a.sbLoading()||SBF.search(s,()=>{a.sbLoading(!0),e(s,a)})}function vt(t,e=!1,a=0){if(e)return S(t).scrollTop()+S(t).innerHeight()>=S(t)[0].scrollHeight-1;S(t).scrollTop(S(t)[0].scrollHeight-a)}function mt(t){window.history.pushState("","",t)}function St(){return SB_ADMIN_SETTINGS.cloud?"&cloud="+SB_ADMIN_SETTINGS.cloud.token:""}function _t(t=!1){ht||(!1===c?(c=!0,S.getScript(STMBX_URL+"/vendor/editorjs.js",()=>{_t(t)})):(yt(),ht=!0,c=new EditorJS({data:"string"==typeof t?{time:Date.now(),blocks:[t?{id:"sb",type:"raw",data:{html:t}}:{id:"sb",type:"paragraph",data:{text:""}}]}:t,i18n:{messages:{ui:{blockTunes:{toggler:{"Click to tune":I("Click to tune")}},inlineToolbar:{converter:{"Convert to":I("Convert to")}},toolbar:{toolbox:{Add:I("Add")}}},toolNames:{Text:I("Text"),Heading:I("Heading"),List:I("List"),Image:I("Image"),Code:I("Code"),"Raw HTML":I("Raw HTML"),Bold:I("Bold"),Italic:I("Italic"),Link:I("Link")},tools:{list:{Ordered:I("Ordered"),Unordered:I("Unordered")}},blockTunes:{delete:{Delete:I("Delete")},moveUp:{"Move up":I("Move up")},moveDown:{"Move down":I("Move down")}}}},tools:{list:{class:List,inlineToolbar:!0},image:{class:ImageTool,config:{uploader:{uploadByFile(t){let a=new FormData;return a.append("file",t),new Promise(e=>{S.ajax({url:STMBX_URL+"/include/upload.php",cache:!1,contentType:!1,processData:!1,data:a,type:"POST",success:function(t){"success"==(t=JSON.parse(t))[0]?e({success:1,file:{url:t[1]}}):console.log(t)}})})}}}},header:Header,code:CodeTool,raw:RawTool},onReady:()=>{ht=!1},minHeight:50})))}function yt(){typeof c.destroy!==ut&&(c.destroy(),c=!1)}S.fn.sbLanguageSwitcher=function(t=[],e="",a=!1){let s=`<div class="sb-language-switcher" data-source="${e}">`,i=[],n=S(this).hasClass("sb-language-switcher-cnt")?S(this):S(this).find(".sb-language-switcher-cnt");for(var o=0;o<t.length;o++)i.includes(t[o])||(s+=`<span ${a==t[o]?'class="sb-active" ':""}data-language="${t[o]}"><i class="bi-x-lg"></i><img src="${STMBX_URL}/media/flags/${t[o].toLowerCase()}.png" /></span>`,i.push(t[o]));return n.find(".sb-language-switcher").remove(),n.append(s+`<i data-sb-tooltip="${I("Add translation")}" class="bi-plus-lg"></i></div>`),this},S.fn.sbShowLightbox=function(t=!1,e=""){function a(){var t=S(this),e=t.outerHeight()/-2-25;t.css({"margin-top":e+"px","margin-left":t.outerWidth()/-2+"px"})}return d.find(".sb-lightbox").sbActive(!1),K.sbActive(!0),S(this).sbActive(!0),t?S(this).addClass("sb-popup-lightbox").attr("data-action",e):(a.call(this),S(window).on("resize",function(){a.call(this)})),S("body").addClass("sb-lightbox-active"),setTimeout(()=>{U.open_popup=this},300),this.preventDefault,this};var E={dialogflow:{intents:!(S.fn.sbHideLightbox=function(){return S(this).find(".sb-lightbox,.sb-popup-lightbox").sbActive(!1).removeClass("sb-popup-lightbox").removeAttr("data-action"),K.sbActive(!1),S("body").removeClass("sb-lightbox-active"),U.open_popup=!1,this}),token:SBF.storage("dialogflow-token"),smart_reply_data:!1,smartReply:function(t){SBF.ajax({function:"dialogflow-smart-reply",message:t,smart_reply_data:this.smart_reply_data||{conversation_id:SBChat.conversation.id},token:this.token,dialogflow_language:[T().language?T().language:"en"],language_detection:SB_ADMIN_SETTINGS["smart-reply-language-detection"]&&SBChat.conversation&&!SBChat.conversation.getLastUserMessage(!1,!0)&&(!SB_ADMIN_SETTINGS["smart-reply-language-detection-bot"]||!SBChat.conversation.getLastUserMessage(!1,"bot"))},t=>{var e=t.suggestions;let a="";var s=_.find(".sb-conversation .sb-list"),s=s[0].scrollTop===s[0].scrollHeight-s[0].offsetHeight,i=!(!SBChat.conversation||!SBChat.conversation.getLastMessage())&&SBChat.conversation.getLastMessage().message;t.token&&this.token!=t.token&&(this.token=t.token,SBF.storage("dialogflow-token",t.token));for(var n=0;n<e.length;n++)e[n]!=i&&(a+=`<span>${e[n]}</span>`);this.smart_reply_data=t.smart_reply,H.html(a),s&&SBChat.scrollBottom()})},smartReplyUpdate:function(t,e="agent"){SBF.ajax({function:"dialogflow-smart-reply-update",message:t,smart_reply_data:this.smart_reply_data||{conversation_id:SBChat.conversation.id},token:this.token,dialogflow_language:[T().language],user_type:e})},showCreateIntentBox:function(t){let e="";t=SBChat.conversation.getMessage(t);let a=t.message;if(SBF.isAgent(t.get("user_type")))e=0==(e=(e=SBChat.conversation.getLastUserMessage(t.get("index")))&&e.payload("sb-human-takeover")?SBChat.conversation.getLastUserMessage(e.get("index")):e)?"":e.message;else{e=a;for(var s=SBChat.conversation.messages,i=t.get("index");i<s.length;i++)if(["agent","admin"].includes(s[i].get("user_type"))){a=s[i].message;break}}!1===this.intents&&SBF.ajax({function:"dialogflow-get-intents"},t=>{let e="";if(Array.isArray(t)){for(var a=0;a<t.length;a++)e+=`<option value="${t[a].name}">${t[a].displayName}</option>`;p.find("#sb-intents-select").append(e),this.intents=t}else this.intents=[]}),p.attr("data-message-id",t.id),p.find(".sb-type-text:not(.sb-first)").remove(),p.find(".sb-type-text input").val(e),p.find("textarea").val(a),p.find("#sb-intents-select").val(""),p.find(".sb-search-btn").sbActive(!1).find("input").val(""),this.searchIntents(""),p.sbShowLightbox()},submitIntent:function(s){if(!L(s)){let t=[];var e=p.find("textarea").val();let a=p.find("#sb-intents-select").val();p.find(".sb-type-text input").each(function(){S(this).val()&&t.push(S(this).val())}),""==e&&!a||0==t.length?(SBForm.showErrorMessage(p,"Please insert the bot response and at least one user expression."),S(s).sbLoading(!1)):SBF.ajax({function:""==a?"dialogflow-create-intent":"dialogflow-update-intent",expressions:t,response:e,agent_language:p.find(".sb-dialogflow-languages select").val(),conversation_id:SBChat.conversation.id,intent_name:a},e=>{if(S(s).sbLoading(!1),!0===e)d.sbHideLightbox(),A(""==a?"Intent created":"Intent updated");else{let t="Error";"error"in e&&"message"in e.error&&(t=e.error.message),SBForm.showErrorMessage(p,t)}})}},searchIntents:function(l){l=l.toLowerCase(),SBF.search(l,()=>{var e=!(1<l.length);let a=e?`<option value="">${I("New Intent")}</option>`:"";for(var s=this.intents,i=0;i<s.length;i++){let t=e||s[i].displayName.toLowerCase().includes(l);if(!t&&"trainingPhrases"in s[i])for(var n=s[i].trainingPhrases,o=0;o<n.length;o++){for(var r=0;r<n[o].parts.length;r++)if(n[o].parts[r].text.toLowerCase().includes(l)){t=!0;break}if(t)break}t&&(a+=`<option value="${s[i].name}">${s[i].displayName}</option>`)}p.find("#sb-intents-select").html(a).change()})},previewIntent:function(t){let e="";for(var a=0;a<this.intents.length;a++)if(this.intents[a].name==t){var s="trainingPhrases"in this.intents[a]?this.intents[a].trainingPhrases:[],i=s.length;if(1<i){for(var n=0;n<i;n++)for(var o=0;o<s[n].parts.length&&(e+=`<span>${s[n].parts[o].text}</span>`,15!=o);o++);$(e,"info",!1,"intent-preview-box","",10<i)}break}},translate:function(t,e,a){t.length&&SBF.ajax({function:"google-translate",strings:t,language_code:e,token:this.token},t=>{if(this.token=t[1],!Array.isArray(t[0]))return SBF.error(JSON.stringify(t[0]),"SBApps.dialogflow.translate"),!1;a(t[0])})}},messenger:{check:function(t){return["fb","ig"].includes(t.get("source"))},send:function(t,e,a="",s=[],i,n=!1){SBF.ajax({function:"messenger-send-message",psid:t,facebook_page_id:e,message:a,attachments:s,metadata:i},t=>{n&&n(t)})}},whatsmeow:{check:function(t){return"ww"==t.get("source")},send:function(t,e="",a=[],s=!1,i=!1,n){SBF.ajax({function:"whatsmeow-send-message",to:t,message:e,attachments:a,phone_id:s},t=>{i&&i(t)})},activeUserPhone:function(t=T()){return!!t.getExtra("phone")&&t.getExtra("phone").value.replace("+","")}},waweb:{check:function(t){return"wx"==t.get("source")},send:function(t,e="",a=[],s=!1,i=!1,n){SBF.ajax({function:"waweb-send-message",to:t,message:e,attachments:a,phone_id:s},t=>{i&&i(t)})},activeUserPhone:function(t=T()){return!!t.getExtra("phone")&&t.getExtra("phone").value.replace("+","")}},whatsapp:{check:function(t){return"wa"==t.get("source")},send:function(t,e="",a=[],s=!1,i=!1){SBF.ajax({function:"whatsapp-send-message",to:t,message:e,attachments:a,phone_id:s},t=>{i&&i(t)})},activeUserPhone:function(t=T()){return!!t.getExtra("phone")&&t.getExtra("phone").value.replace("+","")}},telegram:{check:function(t){return"tg"==t.get("source")},send:function(t,e="",a=[],s=!1){SBF.ajax({function:"telegram-send-message",chat_id:t,message:e,attachments:a},t=>{s&&s(t)})}},gbm:{token:!1,check:function(t){return"bm"==t.get("source")},send:function(t,e="",a=[],s=!1){SBF.ajax({function:"gbm-send-message",google_conversation_id:t,message:e,attachments:a,token:this.token},t=>{s&&s(t),this.token=t[2]})}},twitter:{check:function(t){return"tw"==t.get("source")},send:function(t,e="",a=[],s=!1){SBF.ajax({function:"twitter-send-message",twitter_id:t,message:e,attachments:a},t=>{s&&s(t)})}},is:function(t){if(typeof SB_VERSIONS!=ut)switch(t){case"gbm":case"twitter":case"telegram":case"messenger":case"whatsapp":case"waweb":case"whatsmeow":case"dialogflow":case"sb":return!0}return!1}},M={init:!1,save:function(a){if(!L(a)){let o={},r={};switch(f.find(" > .sb-tab > .sb-nav .sb-active").attr("id")){case"tab-articles":this.articles.save(t=>{A(!0===t?"Articles and categories saved":t),S(a).sbLoading(!1)});break;case"tab-automations":let e=m.find(".sb-active").attr("data-id");M.automations.save(t=>{A(!0===t?"Automations saved":t),M.automations.populate(),m.find(`[data-id="${e}"]`).click(),S(a).sbLoading(!1)});break;case"tab-translations":this.translations.updateActive(),SBF.ajax({function:"save-translations",translations:JSON.stringify(this.translations.to_update)},()=>{A("Translations saved"),S(a).sbLoading(!1)});break;default:f.find(".sb-setting").each((t,e)=>{var a=this.get(e),s=S(e).data("setting");if(a[0])if(typeof s!=ut){let t=!1;if(S(e).find("[data-language]").length){var i=S(e).find("[data-language].sb-active");if(t=a[0]in this.translations.originals&&this.translations.originals[a[0]],this.translations.save(e,!!i.length&&i.attr("data-language")),t&&"string"!=typeof t)for(var n in t)t[n]=[t[n],a[1][n][1]]}s in o||(o[s]={}),o[s][a[0]]=[t||a[1],a[2]]}else r[a[0]]=[a[1],a[2]]}),SBF.ajax({function:"save-settings",settings:JSON.stringify(r),external_settings:o,external_settings_translations:this.translations.translations},()=>{A("Settings saved"),S(a).sbLoading(!1),setTimeout(()=>{location.reload()},600)})}}},initPlugins:function(){f.find("textarea").each(function(){S(this).autoExpandTextarea(),S(this).manualExpandTextarea()}),f.find("[data-setting] .sb-language-switcher-cnt").each(function(){S(this).sbLanguageSwitcher(M.translations.getLanguageCodes(S(this).closest("[data-setting]").attr("id")),"settings")})},initColorPicker:function(t=!1){S(t||f).find(".sb-type-color input").colorPicker({renderCallback:function(t,e){S(t.context).closest(".input").find("input").css("background-color",t.text)}})},initHTML:function(e){if("slack-agents"in e){let t="";for(var a in e["slack-agents"][0])t+=`<div data-id="${a}"><select><option value="${e["slack-agents"][0][a]}"></option></select></div>`;f.find("#slack-agents .input").html(t)}},get:function(n){var o=(n=S(n)).attr("id"),r=n.data("type");n.attr("value");switch(r){case"upload":case"range":case"number":case"text":case"password":case"color":return[o,n.find("input").val(),r];case"textarea":return[o,n.find("textarea").val(),r];case"select":return[o,n.find("select").val(),r];case"checkbox":return[o,n.find("input").is(":checked"),r];case"radio":let t=n.find("input:checked").val();return[o,t=SBF.null(t)?"":t,r];case"upload-image":let e=n.find(".image").attr("data-value");return[o,e=SBF.null(e)?"":e,r];case"multi-input":let a={};return n.find(".input > div").each((t,e)=>{e=this.get(e);e[0]&&(a[e[0]]=[e[1],e[2]])}),[o,a,r];case"select-images":return[o,n.find(".input > .sb-active").data("value"),r];case"repeater":return[o,this.repeater("get",n.find(".repeater-item"),""),r];case"double-select":let s={};return n.find(".input > div").each(function(){var t=S(this).find("select").val();-1!=t&&(s[S(this).attr("data-id")]=[t])}),[o,s,r];case"select-checkbox":return[o,n.find(".sb-select-checkbox input:checked").map(function(){return S(this).attr("id")}).get(),r];case"timetable":let i={};return n.find(".sb-timetable > [data-day]").each(function(){var t=S(this).attr("data-day");let a=[];S(this).find("> div > div").each(function(){var t=S(this).html(),e=S(this).attr("data-value");SBF.null(e)?a.push(["",""]):"closed"==e?a.push(["closed","Closed"]):a.push([e,t])}),i[t]=a}),[o,i,r];case"color-palette":return[o,n.attr("data-value"),r]}return["","",""]},set:function(t,e){var a=S(e)[1],s=S(e)[0];switch(t="#"+t,a){case"color":case"upload":case"number":case"text":case"password":f.find(t+" input").val(s);break;case"textarea":f.find(t+" textarea").val(s);break;case"select":f.find(t+" select").val(s);break;case"checkbox":f.find(t+" input").prop("checked","false"!=s&&s);break;case"radio":f.find(t+` input[value="${s}"]`).prop("checked",!0);break;case"upload-image":s&&f.find(t+" .image").attr("data-value",s).css("background-image",`url("${s}")`);break;case"multi-input":for(var i in s)this.set(i,s[i]);break;case"range":var n=s;f.find(t+" input").val(n),f.find(t+" .range-value").html(n);break;case"select-images":f.find(t+" .input > div").sbActive(!1),f.find(t+` .input > [data-value="${s}"]`).sbActive(!0);break;case"select-checkbox":for(var o=0;o<s.length;o++)f.find(`input[id="${s[o]}"]`).prop("checked",!0);f.find(t+" .sb-select-checkbox-input").val(s.join(", "));break;case"repeater":n=this.repeater("set",s,f.find(t+" .repeater-item:last-child"));n&&f.find(t+" .sb-repeater").html(n);break;case"double-select":for(var i in s)f.find(t+` .input > [data-id="${i}"] select`).val(s[i]);break;case"timetable":for(var i in s)for(var r=f.find(t+` [data-day="${i}"] > div > div`),o=0;o<r.length;o++)S(r[o]).attr("data-value",s[i][o][0]).html(s[i][o][1]);break;case"color-palette":s&&f.find(t).attr("data-value",s)}},repeater:function(t,e,a){if(a=S(a).html(),"set"==t){var s="";if(0<e.length){S(a).find(".bi-x-lg").remove();for(var i=0;i<e.length;i++){var n,o=S(S.parseHTML(`<div>${a}</div>`));for(n in e[i])this.setInput(o.find(`[data-id="${n}"]`),e[i][n]);s+=`<div class="repeater-item">${o.html()}<i class="bi-x-lg"></i></div>`}}return s}if("get"==t){let t=[],s=this;return S(e).each(function(){let e={},a=!0;S(this).find("[data-id]").each(function(){var t=s.getInput(this);a&&t&&"hidden"!=S(this).attr("type")&&"auto-id"!=S(this).attr("data-type")&&(a=!1),e[S(this).attr("data-id")]=t}),a||t.push(e)}),t}},repeaterAdd:function(t){let a=S(t).parent();(t=S(S.parseHTML(`<div>${a.find(".repeater-item:last-child").html()}</div>`))).find("[data-id]").each(function(){if(M.resetInput(this),"auto-id"==S(this).data("type")){let e=1;a.find('[data-type="auto-id"]').each(function(){var t=parseInt(S(this).val());t>e&&(e=t)}),S(this).attr("value",e+1)}}),a.find(".sb-repeater").append(`<div class="repeater-item">${t.html()}</div>`)},repeaterDelete:function(t){t=S(t).parent();1<t.parent().find(".repeater-item").length?t.remove():t.find("[data-id]").each((t,e)=>{this.resetInput(e)})},setInput:function(t,e){var a;e=S.trim(e),(t=S(t)).is("select")?t.find(`option[value="${e}"]`).attr("selected",""):t.is(":checkbox")&&e&&"false"!=e?t.attr("checked",""):t.is("textarea")?t.html(e):(a=t.is("div"))||t.is("i")||t.is("li")?(t.attr("data-value",e),a&&t.hasClass("image")&&t.css("background-image",e?`url("${e}")`:"")):t.attr("value",e)},getInput:function(t){var e;return(t=S(t)).is(":checkbox")?t.is(":checked"):t.is("div")||t.is("i")||t.is("li")?(e=t.attr("data-value"),SBF.null(e)?"":e):t.val()},resetInput:function(t){(t=S(t)).is("select")?t.val("").find("[selected]").removeAttr("selected"):t.is("checkbox")&&value?t.removeAttr("checked").prop("checked",!1):t.is("textarea")?t.html(""):t.removeAttr("value").removeAttr("style").removeAttr("data-value").val("")},getSettingObject:function(t){return S(t)[0].hasAttribute("data-setting")?S(t):S(t).closest("[data-setting]")},articles:{categories:[],articles:[],translations:{},get:function(e,t=!1,a=!0){SBF.ajax({function:"get-articles",categories:t,articles_language:"all",full:a},t=>{e(t)})},save:function(e=!1){if(this.updateActiveArticle(),c)if(pt)pt=!1;else if(this.activeID()&&-1!=this.activeID())return void(pt=e);b.find(".sb-new-category-cnt input").each((t,e)=>{var a=S.trim(S(e).val());a&&this.categories.push({id:SBF.random(),title:a}),S(e).parents().eq(1).remove()}),this.categories.length&&this.categories.sort(function(t,e){return t.title.localeCompare(e.title)}),SBF.ajax({function:"save-articles",articles:this.articles,translations:this.translations,categories:this.categories.length?this.categories:"delete_all"},t=>{b.find(".sb-menu-wide .sb-active").click(),b.find(`.sb-nav [data-id="${this.activeID()}"]`).click(),this.updateSelect(),e&&e(t)}),E.is("dialogflow")&&SBF.ajax({function:"dialogflow-knowledge",articles:this.articles})},show:function(t=!1,e=!1,a=!1){let s=[-1,"","","",""];this.updateActiveArticle(),this.hide(!1);var i=a?a in this.translations?this.translations[a]:[]:this.articles;!1===t&&(t=this.activeID());for(var n=0;n<i.length;n++)if(i[n].id==t){s=[t,i[n].title,i[n].content,i[n].link,SBF.null(i[n].categories)?[""]:i[n].categories,SBF.null(i[n].parent_category)?"":i[n].parent_category,i[n].editor_js],e&&(S(e).siblings().sbActive(!1),S(e).sbActive(!0));break}V.val(""),z.val(s[5]);for(n=0;n<s[4].length;n++)V.eq(n).val(s[4][n]);b.sbLanguageSwitcher(this.getTranslations(t),"articles",a),b.find(".sb-content").attr("data-id",s[0]),b.find(".sb-article-title input").val(s[1]),b.find(".sb-article-link input").val(s[3]),b.find("#sb-article-id").html(`ID <span>${s[0]}</span>`),c||b.find("#editorjs").length?_t(s[6]||s[2]):b.find(".sb-article-content textarea").val(s[2])},add:function(){var t=b.find(".sb-nav > ul"),e=SBF.random();this.updateActiveArticle(),this.articles.push({id:e,title:"",content:"",link:"",categories:[]}),this.hide(!1),t.find(".sb-active").sbActive(!1),t.find(".sb-no-results").remove(),t.append(`<li class="sb-active" data-id="${e}">${I("Article")} ${t.find("li").length+1}<i class="bi-trash"></i></li>`),b.find("input, textarea, select").val(""),b.find(".sb-content").attr("data-id",e),b.sbLanguageSwitcher([],"articles"),_t()},addCategory:function(){b.find('[data-type="categories"] .sb-no-results').remove(),b.find(".sb-new-category-cnt").append('<div class="sb-input-setting sb-type-text"><div><input type="text"></div></div>')},delete:function(t,e=!1){var a,s=S(t).closest(".sb-nav").find(" > ul"),i=S(t).parent(),n=i.attr("data-id");for(a in this[e?"categories":"articles"].splice(i.index(),1),this.hide(),1<s.find("li").length?S(t).parent().remove():s.html(`<li class="sb-no-results">${I("No results found.")}</li>`),this.translations)for(var o=0;o<this.translations[a].length;o++)this.translations[a][o].id===n&&this.translations[a].splice(o,1);e||yt()},populate:function(e=!1,a=!1){if(!1===e&&(e=a?this.categories:this.articles),Array.isArray(e)){let t="";if(a?this.categories=e:this.articles=e,e.length)for(var s=0;s<e.length;s++)t+=`<li data-id="${e[s].id}">${a?"<span>"+e[s].id+"</span>":""}${e[s].title}<i class="bi-trash${a?" sb-category":""}"></i></li>`;else t=`<li class="sb-no-results">${I("No results found.")}</li>`;b.find(".sb-add-category,.sb-new-category-cnt").sbActive(a),b.find(".sb-add-article").sbActive(!a),b.find(".sb-nav").attr("data-type",a?"categories":"articles"),b.find(".sb-nav > ul").html(t),this.hide()}else SBF.error(e,"SBSettings.articles.populate")},updateActiveArticle:function(){var a=this.activeID();if(-1!=a){var s=b.find(".sb-language-switcher [data-language].sb-active").attr("data-language");let e=s?s in this.translations?this.translations[s]:[]:this.articles,t=[];V.each(function(){S(this).val()&&t.push(S(this).val())});for(var i=0;i<e.length;i++)if(e[i].id==a){article={id:a,title:b.find(".sb-article-title input").val(),content:b.find(".sb-article-content textarea").val(),link:b.find(".sb-article-link input").val(),categories:t,parent_category:z.val()},c&&typeof c.save!==ut?c.save().then(t=>{article.editor_js=t,article.content=function(t){let e="";return t.map(t=>{switch(t.type){case"header":e+=`<h${t.data.level}>${t.data.text}</h${t.data.level}>`;break;case"paragraph":e+=`<p>${t.data.text}</p>`;break;case"image":e+=`<img class="img-fluid" src="${t.data.file.url}" title="${t.data.caption}" /><em>${t.data.caption}</em>`;break;case"list":e+='<ul class="sb-ul-'+t.data.style+'">',t.data.items.forEach(function(t){e+=`<li>${t}</li>`}),e+="</ul>";break;case"code":e+=`<code>${t.data.code}</code>`;break;case"raw":e+=`<div class="bxc-raw-html">${t.data.html}</div>`}}),e}(t.blocks),e[i]=article,pt&&this.save(pt)}).catch(t=>{console.log(t)}):e[i]=article,SBF.null(article.title)&&this.delete(b.find(`.sb-nav [data-id="${a}"] i`));break}}},updateSelect:function(){let t=[];var e=z.val();let a='<option value=""></option>';V.each(function(){t.push(S(this).val())});for(var s=0;s<this.categories.length;s++)a+=`<option value="${this.categories[s].id}">${this.categories[s].title}</option>`;V.html(a),z.html(a),z.val(e);for(s=0;s<t.length;s++)V.eq(s).val(t[s])},addTranslation:function(t=!1,e){if(!1===t&&(t=this.activeID()),this.getTranslations(t).includes(t))return console.warn("Article translation already in array.");e in this.translations||(this.translations[e]=[]),this.translations[e].push({id:t,title:"",content:"",link:"",categories:[]})},getTranslations:function(t=!1){var e,a=[];for(e in!1===t&&(t=this.activeID()),this.translations)for(var s=this.translations[e],i=0;i<s.length;i++)if(s[i].id==t){a.push(e);break}return a},deleteTranslation:function(t=!1,e){if(!1===t&&(t=this.activeID()),e in this.translations)for(var a=this.translations[e],s=0;s<a.length;s++)if(a[s].id==t)return this.translations[e].splice(s,1),!0;return!1},activeID:function(){return b.find(".sb-content").attr("data-id")},hide:function(t=!0){b.find(".sb-content").setClass("sb-hide",t)}},automations:{items:{messages:[],emails:[],sms:[],popups:[],design:[],more:[]},translations:{},conditions:{datetime:["Date time",["Is between","Is exactly"],"dd/mm/yyy hh:mm - dd/mm/yyy hh:mm"],repeat:["Repeat",["Every day","Every week","Every month","Every year"]],browsing_time:["Browsing time",[],"seconds"],scroll_position:["Scroll position",[],"px"],include_urls:["Include URLs",["Contains","Does not contain","Is exactly","Is not"],"URLs parts separated by commas"],exclude_urls:["Exclude URLs",["Contains","Does not contain","Is exactly","Is not"],"URLs parts separated by commas"],referring:["Referring URLs",["Contains","Does not contain","Is exactly","Is not"],"URLs parts separated by commas"],user_type:["User type",["Is visitor","Is lead","Is user","Is not visitor","Is not lead","Is not user"]],returning_visitor:["Returning visitor",["First time visitor","Returning visitor"]],countries:["Countries",[],"Country codes separated by commas"],languages:["Languages",[],"Language codes separated by commas"],cities:["Cities",[],"Cities separated by commas"],custom_variable:["Custom variable",[],"variable=value"]},get:function(e){SBF.ajax({function:"automations-get"},t=>{this.items=t[0],this.translations=Array.isArray(t[1])&&!t[1].length?{}:t[1],e(t)})},save:function(e=!1){this.updateActiveItem(),SBF.ajax({function:"automations-save",automations:this.items,translations:this.translations},t=>{e&&e(t)})},show:function(t=!1,e=!1){this.updateActiveItem();var a=e?e in this.translations?this.translations[e]:[]:this.items,s=v.find(" > .sb-tab > .sb-content");for(r in!1===t&&(t=this.activeID()),this.hide(!1),a)for(var i=0;i<a[r].length;i++){var n=a[r][i],o=n.conditions;if(n.id==t){for(var r in X.html(""),n){var l=s.find(`[data-id="${r}"]`);l.hasClass("image")?(l.css("background-image",`url(${n[r]})`).attr("data-value",n[r]),""==n[r]&&l.removeAttr("data-value")):"checkbox"==l.attr("type")?l.prop("checked",n[r]):l.val(n[r])}if(o)for(var r in o){this.addCondition();var c=X.find(" > div:last-child");c.find("select").val(o[r][0]),this.updateCondition(c.find("select")),c.find(" > div").eq(1).find("select,input").val(o[r][1]),2<o[r].length&&c.find(" > div").eq(2).find("input").val(o[r][2])}return X.parent().setClass("sb-hide",e),s.sbLanguageSwitcher(this.getTranslations(t),"automations",e),!0}}return!1},add:function(){var t=SBF.random(),e=I("Item")+" "+(m.find("li:not(.sb-no-results)").length+1);this.updateActiveItem(),this.items[this.activeType()].push(this.itemArray(this.activeType(),t,e)),this.hide(!1),m.find(".sb-active").sbActive(!1),m.find(".sb-no-results").remove(),m.append(`<li class="sb-active" data-id="${t}">${e}<i class="bi-trash"></i></li>`),v.find(".sb-automation-values").find("input, textarea").val(""),v.sbLanguageSwitcher([],"automations"),X.html("")},delete:function(t){this.items[this.activeType()].splice(S(t).parent().index(),1),S(t).parent().remove(),this.hide(),0==this.items[this.activeType()].length&&m.html(`<li class="sb-no-results">${I("No results found.")}</li>`)},populate:function(t=!1){!1===t&&(t=this.activeType());let e="";var a=this.items[t];if(this.updateActiveItem(),a.length)for(var s=0;s<a.length;s++)e+=`<li data-id="${a[s].id}">${a[s].name}<i class="bi-trash"></i></li>`;else e=`<li class="sb-no-results">${I("No results found.")}</li>`;switch(m.html(e),e="",t){case"emails":e=`<h2>${I("Subject")}</h2><div class="sb-input-setting sb-type-text"><div><input data-id="subject" type="text"></div></div>`;break;case"popups":e=`<h2>${I("Title")}</h2><div class="sb-input-setting sb-type-text"><div><input data-id="title" type="text"></div></div><h2>${I("Profile image")}</h2><div data-type="upload-image" class="sb-input-setting sb-type-upload-image"><div class="input"><div data-id="profile_image" class="image"><i class="bi-x-lg"></i></div></div></div><h2>${I("Message fallback")}</h2><div class="sb-input-setting sb-type-checkbox"><div><input data-id="fallback" type="checkbox"></div></div>`;break;case"design":e=`<h2>${I("Header title")}</h2><div class="sb-input-setting sb-type-text"><div><input data-id="title" type="text"></div></div>`;for(s=1;s<4;s++)e+=`<h2>${I((1==s?"Primary":2==s?"Secondary":"Tertiary")+" color")}</h2><div data-type="color" class="sb-input-setting sb-type-color"><div class="input"><input data-id="color_${s}" type="text"><i class="sb-close bi-x-lg"></i></div></div>`;for(s=1;s<4;s++)e+=`<h2>${I(1==s?"Header background image":2==s?"Header brand image":"Chat button icon")}</h2><div data-type="upload-image" class="sb-input-setting sb-type-upload-image"><div class="input"><div data-id="${1==s?"background":2==s?"brand":"icon"}" class="image"><i class="bi-x-lg"></i></div></div></div>`;break;case"more":e=`<h2>${I("Department ID")}</h2><div class="sb-input-setting sb-type-number"><div><input data-id="department" type="number"></div></div><h2>${I("Agent ID")}</h2><div class="sb-input-setting sb-type-number"><div><input data-id="agent" type="number"></div></div><h2>${I("Tags")}</h2><div class="sb-input-setting sb-type-text"><div><input data-id="tags" type="text"></div></div>`}v.find(".sb-automation-extra").html(e),v.attr("data-automation-type",t),M.initColorPicker(v),this.hide()},updateActiveItem:function(){var t=this.activeID();if(t){var a=v.find(".sb-language-switcher [data-language].sb-active").attr("data-language"),s=this.activeType();let e=a?a in this.translations?this.translations[a][s]:[]:this.items[s];for(var i=X.find(" > div"),n=0;n<e.length;n++)if(e[n].id==t){e[n]={id:t,conditions:[]},v.find(".sb-automation-values").find('input,textarea,[data-type="upload-image"] .image').each(function(){e[n][S(this).attr("data-id")]=S(this).hasClass("image")&&S(this)[0].hasAttribute("data-value")?S(this).attr("data-value"):"checkbox"==S(this).attr("type")?S(this).is(":checked"):S(this).val()}),i.each(function(){let t=[];S(this).find("input,select").each(function(){t.push(S(this).val())}),t[0]&&t[1]&&(2==t.length||t[2])&&e[n].conditions.push(t)}),SBF.null(e[n].name)&&this.delete(m.find(`[data-id="${t}"] i`));break}}},addCondition:function(){X.append(`<div><div class="sb-input-setting sb-type-select sb-condition-1"><select>${this.getAvailableConditions()}</select></div></div>`)},updateCondition:function(e){S(e).parent().siblings().remove();var a=S(e).parents().eq(1);if(S(e).val()){var s=this.conditions[S(e).val()];let t="";if(s[1].length){t='<div class="sb-input-setting sb-type-select sb-condition-2"><select>';for(var i=0;i<s[1].length;i++)t+=`<option value="${SBF.stringToSlug(s[1][i])}">${I(s[1][i])}</option>`;t+="</select></div>"}a.append(t+(2<s.length?`<div class="sb-input-setting sb-type-text"><input placeholder="${I(s[2])}" type="text"></div>`:"")),a.siblings().find(".sb-condition-1 select").each(function(){var t=S(this).val();S(this).html(M.automations.getAvailableConditions(t)),S(this).val(t)})}else a.remove()},getAvailableConditions:function(t=""){let e='<option value=""></option>',a=[];for(var s in X.find(".sb-condition-1 select").each(function(){a.push(S(this).val())}),this.conditions)a.includes(s)&&s!=t||(e+=`<option value="${s}">${I(this.conditions[s][0])}</option>`);return e},addTranslation:function(t=!1,e=!1,a){if(!1===t&&(t=this.activeID()),!1===e&&(e=this.activeType()),this.getTranslations(t).includes(t))return console.warn("Automation translation already in array.");a in this.translations||(this.translations[a]={messages:[],emails:[],sms:[],popups:[],design:[]}),e in this.translations[a]||(this.translations[a][e]=[]),this.translations[a][e].push(this.itemArray(e,t))},getTranslations:function(t=!1){var e,a=[];for(e in!1===t&&(t=this.activeID()),this.translations){var s,i=this.translations[e];for(s in i)for(var n=i[s],o=0;o<n.length;o++)if(n[o].id==t){a.push(e);break}}return a},deleteTranslation:function(t=!1,e){if(!1===t&&(t=this.activeID()),e in this.translations){var a,s=this.translations[e];for(a in s)for(var i=s[a],n=0;n<i.length;n++)if(i[n].id==t)return this.translations[e][a].splice(n,1),!0}return!1},activeID:function(){var t=m.find(".sb-active");return!!t.length&&t.attr("data-id")},activeType:function(){return W.find("li.sb-active").data("value")},itemArray:function(t,e,a="",s=""){return S.extend({id:e,name:a,message:s},"emails"==t?{subject:""}:"popups"==t?{title:"",profile_image:""}:"design"==t?{title:"",color_1:"",color_2:"",color_3:"",background:"",brand:"",icon:""}:{})},hide:function(t=!0){v.find(" > .sb-tab > .sb-content").setClass("sb-hide",t)}},translations:{translations:{},originals:{},to_update:{},add:function(t){var e=M.getSettingObject(Z),a=e.attr("id"),s=Z.find("[data-language].sb-active");this.save(e,!!s.length&&s.attr("data-language")),e.find('textarea,input[type="text"]').val(""),this.save(e,t),Z.remove(),e.sbLanguageSwitcher(this.getLanguageCodes(a),"settings",t)},delete:function(t,e){var a=(t=M.getSettingObject(t)).attr("id");delete this.translations[e][a],t.find(`.sb-language-switcher [data-language="${e}"]`).remove(),this.activate(t)},activate:function(t,e=!1){var a=(t=M.getSettingObject(t)).attr("id"),s=(e?this.translations[e]:this.originals)[a];if("string"==typeof s)t.find("input, textarea").val(s);else for(var i in s)t.find("#"+i).find("input, textarea").val("string"==typeof s[i]?s[i]:s[i][0])},updateActive:function(){var t=f.find(".sb-translations-list");let a={front:{},admin:{},"admin/js":{},"admin/settings":{}};var e=t.attr("data-value");if(!SBF.null(e)){for(var s in a)t.find(' > [data-area="'+s+'"] .sb-input-setting:not(.sb-new-translation)').each(function(){a[s][S(this).find("label").html()]=S(this).find("input").val()}),t.find('> [data-area="'+s+'"] .sb-new-translation').each(function(){var t=S(this).find("input:first-child").val(),e=S(this).find("input:last-child").val();t&&e&&(a[s][t]=e)});this.to_update[e]=a}},save:function(t,e=!1){t=M.getSettingObject(t);let a={};var s=S(t).attr("id");"multi-input"==t.data("type")?t.find(".multi-input-textarea,.multi-input-text").each(function(){a[S(this).attr("id")]=S(this).find("input, textarea").val()}):a=t.find("input, textarea").val(),e?(e in this.translations||(this.translations[e]={}),this.translations[e][s]=a):this.originals[s]=a},load:function(o){let r=f.find(".sb-translations > .sb-content");r.find(" > .sb-hide").removeClass("sb-hide"),this.updateActive(),SBF.ajax({function:"get-translation",language_code:o},t=>{o in this.to_update&&(t=this.to_update[o]);let e="";for(var a=["front","admin","admin/js","admin/settings"],s=0;s<a.length;s++){var i,n=t[a[s]];for(i in e+=`<div${s?"":' class="sb-active"'} data-area="${a[s]}">`,n)e+=`<div class="sb-input-setting sb-type-text"><label>${i}</label><div><input type="text" value="${n[i]}"></div></div>`;e+="</div>"}r.find(".sb-translations-list").attr("data-value",o).html(e),r.find(".sb-menu-wide li").sbActive(!1).eq(0).sbActive(!0),r.sbLoading(!1)}),r.sbLoading(!0)},getLanguageCodes:function(t){var e,a=[];for(e in this.translations)t in this.translations[e]&&a.push(e);return a}}},a={chart:!1,active_report:!1,initChart:function(t,e="line",n=1){let o=[];var a,s=[],i=["#0eacb2","#299fb1","#4492b0","#5d86ae","#7379ac","#867cae","#9b70ad","#b06bae","#c465af","#d65fb1"];for(a in t)o.push(t[a][0]),s.push(a);if("line"!=e&&6<o.length)for(var r=0;r<o.length;r++)i.push("hsl(210, "+Math.floor(100*Math.random())+"%, "+Math.floor(100*Math.random())+"%)");this.chart&&this.chart.destroy(),this.chart=new Chart(x.find("canvas"),{type:e,data:{labels:s,datasets:[{data:o,backgroundColor:"line"==e?"#d4e7e952":i,borderColor:"line"==e?"#5c00ff":i,borderWidth:1}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{callback:function(t,e,a){return 1!=n&&2==n?new Date(1e3*t).toISOString().substr(11,8):t},beginAtZero:!0}}],xAxes:[{ticks:{beginAtZero:!0}}]},tooltips:{callbacks:{label:function(t,e){var a=t.index,s=e.datasets[0].data[a];switch(n){case 1:return s;case 2:return new Date(1e3*o[a]).toISOString().substr(11,8);case 3:return s+"%";case 4:var i=x.find(".sb-table tbody tr").eq(a).find("td");return i.eq(0).text()+" "+i.eq(1).text()}}},displayColors:!1}}})},initTable:function(t,e,a=!1){let s="<thead><tr>";for(var i,n=e[Object.keys(e)[0]].length-1,o=[],r=0;r<t.length;r++)s+=`<th>${t[r]}</th>`;for(i in s+="</tr></thead><tbody>",e)0!=e[i][n]&&o.push([i,e[i][n]]);a&&o.reverse();for(r=0;r<o.length;r++)s+=`<tr><td><div>${o[r][0]}</div></td><td>${o[r][1]}</td></tr>`;s+="</tbody>",x.find("table").html(s)},initReport:function(t=!1,e=!1){let n=x.find(".sb-tab > .sb-content");e=SBF.null(e)?[!1,!1]:e.split(" - "),n.sbLoading(!0),t&&(this.active_report=t),this.active_report&&this.getData(this.active_report,e[0],e[1],i=>{0==i?n.addClass("sb-no-results-active"):(n.removeClass("sb-no-results-active"),"status-client"==this.active_report?(n.addClass("sb-results-active"),n.find("#"+this.active_report).attr("style","display:block!important"),n.find(".sb-reports-tags .sb-tags").html(""),gt.forEach(t=>{let e=t;t=i.data.filter(t=>t.label==e);let s="";t.map(e=>{let a="";i.extra.map(t=>{t.user_id==e.user_id&&(a+=`<li class="add-user agent-name-tags">${t.first_name}</li>`)}),s+=`<div class="sb-responsive-tags">${e.first_name} ${e.last_name}<section class="flex-agents">${a}</section></div>`});var a=S('<div style="min-width: 180px;max-width: 554px;" class="sb-tags-details sb-hide"></div>');""!==s.trim()&&a.removeClass("sb-hide"),a.append(`<div>
								<h4 class="title-tags tags-${e}">
									<div>
										<i class="sb-icon bi-kanban-fill tags-${e}"></i>
									</div>
									<div class="white-title-elements">
										${e.toUpperCase()}(${t.length})
									</div>
									<div>
										<div class="arrow-down-tags white-title-elements">
											<i class="bi-check-lg"></i>
										</div>
									</div>
								</h4>
							</div>
							<div style="overflow: scroll;max-height: 420px;">${s}</div>`),n.find(".sb-reports-tags .sb-tags").append(a)})):(n.removeClass("sb-results-active"),n.find("#status-client").attr("style","display:none!important")),i.chart_type&&(this.initChart(i.data,i.chart_type,i.label_type),this.initTable(i.table,i.data,i["table-inverse"])),x.find(".sb-reports-title").html(i.title),x.find(".sb-reports-text").html(i.description),x.find(".bi-chevron-down").remove(),C||ft(x.find(".sb-collapse"),x.find("canvas").outerHeight()-135)),n.sbLoading(!1)})},getData:function(t,e=!1,a=!1,s){SBF.ajax({function:"reports",name:t,date_start:e,date_end:a},t=>{s(t)})},initDatePicker:function(){var t={ranges:{},applyClass:"reports-datepicker",locale:{format:"DD/MM/YYYY",separator:" - ",applyClass:"reports-datepicker",applyLabel:I("Apply"),cancelLabel:I("Cancel"),fromLabel:I("From"),toLabel:I("To"),weekLabel:I("W"),daysOfWeek:[I("Su"),I("Mo"),I("Tu"),I("We"),I("Th"),I("Fr"),I("Sa")],monthNames:[I("January"),I("February"),I("March"),I("April"),I("May"),I("June"),I("July"),I("August"),I("September"),I("October"),I("November"),I("December")],firstDay:1},showCustomRangeLabel:!1,alwaysShowCalendars:!0,autoApply:!0};t.ranges[I("Today")]=[moment(),moment()],t.ranges[I("Yesterday")]=[moment().subtract(1,"days"),moment().subtract(1,"days")],t.ranges[I("Last 3 Days")]=[moment().subtract(2,"days"),moment()],t.ranges[I("Last 5 Days")]=[moment().subtract(4,"days"),moment()],t.ranges[I("Last 7 Days")]=[moment().subtract(6,"days"),moment()],t.ranges[I("Last 15 Days")]=[moment().subtract(14,"days"),moment()],t.ranges[I("This Month")]=[moment().startOf("month"),moment().endOf("month")],x.find("#sb-date-picker").daterangepicker(t).val("")}},D={real_time:null,datetime_last_user:"2000-01-01 00:00:00",sorting:["creation_time","DESC"],user_types:["visitor","lead","user"],user_main_fields:["id","first_name","last_name","email","password","profile_image","user_type","creation_time","token","last_activity","department"],search_query:"",init:!1,busy:!1,table_extra:!1,history:[],filter:function(t){this.user_types=t="all"==t?["visitor","lead","user"]:"agent"==t?["agent","admin"]:[t],this.loading(),nt=it=1;var e="online"==t[0]?["get-online-users",SB_ACTIVE_AGENT.id,this.sorting[0]]:["get-users",-1,this.sorting];SBF.ajax({function:e[0],sorting:e[2],user_types:t,search:this.search_query,extra:this.table_extra},t=>{this.populate(t),this.loading(!1)})},sort:function(t,e="DESC"){this.sorting=[t,e],this.loading(),nt=it=1,SBF.ajax({function:"get-users",sorting:this.sorting,user_types:this.user_types,search:this.search_query,extra:this.table_extra},t=>{this.populate(t),this.loading(!1),console.log("Sorting completed successfully:",t)})},search:function(t){bt(t,(e,a)=>{nt=it=1,SBF.ajax({function:1<e.length?"search-users":"get-users",search:e,user_types:this.user_types,sorting:this.sorting,extra:this.table_extra},t=>{this.user_types=["lead"],this.populate(t),this.search_query=e,S(a).sbLoading(!1),h.find("li").sbActive(!1).eq(0).sbActive(!0)})})},populate:function(t){let e="";var a=t.length;if(a)for(var s=0;s<a;s++)e+=this.getRow(new SBUser(t[s],t[s].extra));else e=`<p class="sb-no-results">${I("No users found.")}</p>`;l.parent().scrollTop(0),l.find("tbody").html(e),this.user_types.includes("agent")&&SBF.ajax({function:"get-online-users",agents:!0},t=>{let e=[];for(var a=0;a<t.length;a++)e.push(t[a].id);l.find("[data-user-id]").each(function(){S(this).find(".sb-td-profile").addClass("sb-"+(e.includes(S(this).attr("data-user-id"))?"online":"offline"))})})},update:function(){if(!this.busy){let n=["user","visitor","lead","agent"],o=n.includes(this.user_types[0])&&""==this.search_query,r=h.find(".sb-active").data("type");"online"==r?this.filter(r):(this.busy=!0,SBF.ajax({function:"get-new-users",datetime:this.datetime_last_user},e=>{var a=e.length;if(this.busy=!1,0<a){let t="";for(var s=0;s<a;s++){var i=new SBUser(e[s]);k[i.id]=i,this.updateMenu("add",i.type),o&&(t+=this.getRow(i))}if(o&&(l.find("tbody").prepend(t),n.includes(r))){let t="";for(s=0;s<n.length;s++)t+=n[s]==r?"":`[data-user-type="${n[s]}"],`;l.find(t.slice(0,-1)).remove()}this.datetime_last_user=e[0].creation_time}}))}},getRow:function(e,t){if(e instanceof SBUser){let t="";for(var a=0;a<this.table_extra.length;a++){var s=this.table_extra[a];t+=`<td class="sb-td-${s}">${this.user_main_fields.includes(s)?e.get(s):e.getExtra(s)}</td>`}return`<tr data-user-id="${e.id}" data-user-type="${e.type}"><td><input type="checkbox" /></td><td class="sb-td-profile"><a class="sb-profile"><img loading="lazy" src="${e.image}" class="sb-tags tags-${e.details.label}" style="max-width: 27px;max-height: 27px;padding: 2px;border:none;" /><span style="margin:0px 1px">${25<e.name.length?e.name.slice(0,25)+"...":e.name}</span></a></td>${t}<td style="overflow: hidden;max-width: 80px;text-overflow: ellipsis;overflow-wrap: break-word;" class="sb-td-email"class="sb-td-email">${e.get("email")}</td><td class="sb-td-ut">${I(e.type)}</td><td>${SBF.beautifyTime(e.get("last_activity"),!0)}</td><td>${SBF.beautifyTime(e.get("creation_time"),!0)}</td></tr>`}return SBF.error("User not of type SBUser","SBUsers.getRow"),!1},updateRow:function(t){var e,a,s=l.find(`[data-user-id="${t.id}"]`);s.length?(e=h.find(".sb-active").data("type"))===t.type||"admin"===t.type&&"agent"===e||"all"===e?(e=this.getRow(t),s.replaceWith(e),this.updateTagsLabel(t)):(e=d.find(`[data-type="${"admin"===t.type?"agent":t.type}"] span`),a=parseInt(e.attr("data-count")),e.html(a+1).attr("data-count",a+1),s.remove()):l.find("tbody").append(this.getRow(t))},updateTagsLabel:function(t){S(`[data-user-id="${t.id}"] .sb-tags`).removeClass().addClass("sb-tags tags-"+t.details.label)},updateMenu:function(t="all",e=!1){let a=["all","user","agent","lead","visitor"];"all"==t?SBF.ajax({function:"count-users"},t=>{for(var e=0;e<a.length;e++)this.updateMenuItem("set",a[e],t[a[e]])}):this.updateMenuItem(t,e)},updateMenuItem:function(t="set",e=!1,a=1){var e=h.find(`[data-type="${e}"] span`),s=["user","lead","visitor","agent"];"set"!==t&&(a=parseInt(e.attr("data-count"))+("add"===t?1:-1)),e.html(`<span style="vertical-align: sub;color: var(--chat-text-primary); font-weight:bold;">(${a})</span>`).attr("data-count",a);for(let t=a=0;t<s.length;t++)a+=parseInt(h.find(`[data-type="${s[t]}"] span`).attr("data-count"));h.find('[data-type="all"] span').html(`<span style="vertical-align: sub;color: var(--color-red); font-weight:bold;">(${a})</span>`).attr("data-count",a)},delete:function(e){this.loading(),Array.isArray(e)?SBF.ajax({function:"delete-users",user_ids:e},()=>{for(var t=0;t<e.length;t++)delete k[e[t]],l.find(`[data-user-id="${e[t]}"]`).remove(),y.find(`[data-user-id="${e[t]}"]`).remove();0==l.find("[data-user-id]").length&&this.filter(h.find(".sb-active").data("type")),A("Users deleted"),this.updateMenu(),this.loading(!1)}):k[e].delete(()=>{var t=y.find(`[data-user-id="${e}"]`);T().id==e&&T(!1),t.sbActive()&&(SBChat.conversation=!1,setTimeout(()=>{N.clickFirst()},300)),delete k[e],l.find(`[data-user-id="${e}"]`).remove(),t.remove(),d.sbHideLightbox(),A("User deleted"),this.updateMenu(),this.loading(!1)})},startRealTime:function(){SBPusher.active||(this.stopRealTime(),this.real_time=setInterval(()=>{this.update()},1e4))},stopRealTime:function(){clearInterval(this.real_time)},loading:function(t=!0){var e=o.find(".sb-loading-table");t?e.sbActive(!0):e.sbActive(!1)},csv:function(){SBF.ajax({function:"csv-users"},t=>{var t=JSON.parse(t),e=atob(t.file),e=new Blob([e],{type:"data:application/octet-stream;base64"}),a=document.createElement("a");a.href=window.URL.createObjectURL(e),a.download=t.filename,document.body.appendChild(a),a.click(),document.body.removeChild(a)})},updateUsersActivity:function(){SBF.updateUsersActivity(ct?SB_ACTIVE_AGENT.id:-1,T()?T().id:-1,function(t){D.setActiveUserStatus("online"==t)})},setActiveAgentStatus:function(t=!0){var e=t?"online":"offline";ct=t,i.find('[data-value="status"]').html(I(SBF.slugToString(e))).attr("class","sb-"+e),SBPusher.active&&(t?SBPusher.presence():SBPusher.presenceUnsubscribe()),SB_ADMIN_SETTINGS.reports_disabled||SBF.ajax({function:"reports-update",name:e})},setActiveUserStatus:function(t=!0){var e=_.find(".sb-conversation .sb-top > .sb-labels");e.find(".sb-status-online").remove(),t&&e.prepend(`<span class="sb-status-online">${I("Online")}</span>`),SBChat.user_online=t},onlineUserNotification:function(t){var e,a,s=SB_ADMIN_SETTINGS["online-users-notification"];s&&(e=t.info.first_name+" "+t.info.last_name,a=this.userProfileImage(t.info.profile_image),SB_ADMIN_SETTINGS["push-notifications"]&&"id"in t.info&&!this.history.includes(t.info.id)?SBF.ajax({function:"push-notification",title:s,message:e,icon:a,interests:SB_ACTIVE_AGENT.id,user_id:t.info.id}):N.desktop_notifications&&SBChat.desktopNotification(s,e,a,!1,t.info.id),this.history.push(t.info.id))},userProfileImage:function(t){return!t||t.indexOf("user.svg")?SB_ADMIN_SETTINGS["notifications-icon"]:t}},N={real_time:null,datetime_last_conversation:"2000-01-01 00:00:00",user_typing:!1,desktop_notifications:!1,flash_notifications:!1,busy:!1,is_search:!1,menu_count_ajax:!1,chat_tops:[{}],open:function(t=-1,e){-1!=t&&this.openConversation(t,e),d.sbHideLightbox(),i.find(".sb-admin-nav a").sbActive(!1).parent().find("#sb-conversations").sbActive(!0),d.find(" > main > div").sbActive(!1),_.sbActive(!0).find(".sb-board").removeClass("sb-no-conversation"),this.startRealTime()},openConversation:function(e,t=!1,b=!0){if(!1===t&&e)SBF.ajax({function:"get-user-from-conversation",conversation_id:e},t=>{SBF.null(t.id)?SBF.error("Conversation not found","SBAdmin.openConversation"):this.openConversation(e,t.id,b)});else{let g=_.find(".sb-conversation .sb-list");var a=SBF.null(k[t])||!("email"in k[t].details);let f=_.find(`[data-conversation-id="${e}"]`);g.html(""),g.sbLoading(!0),a?(T(new SBUser({id:t})),T().update(()=>{k[t]=T(),this.updateUserDetails()})):(T(k[t]),this.updateCurrentURL()),SBPusher.active&&(SBPusher.event("client-typing",t=>{t.user_id==T().id&&(N.typing(!0),clearTimeout(n),n=setTimeout(()=>{N.typing(!1)},1e3))}),SBPusher.event("new-message",()=>{SBChat.update()}),SBPusher.event("agent-active-conversation-changed",t=>{t.previous_conversation_id==e&&_.find(".sb-conversation-busy").remove()},"agents"),SBPusher.event("init",t=>{N.updateCurrentURL(t.current_url)}),SBPusher.event("message-status-update",t=>{SBChat.conversation&&SBChat.conversation.updateMessagesStatus(t.message_ids)})),y.find("li").sbActive(!1),f.sbActive(!0),-1!=e?T().getFullConversation(e,e=>{let t=e.get("conversation_status_code");var a=G.eq(0),s=a.find(".sb-active").attr("data-value"),i=(SBChat.setConversation(e),SBChat.populate(),this.setReadIcon(t),_.find(".sb-conversation-busy").remove(),this.updateUserDetails(),e.get("profile_image")),n=e.get("first_name"),o=S(window).width();let r;r=o<555?18<n.length?n.slice(0,18)+"...":n:27<n.length?n.slice(0,27)+"...":n;n=T().getExtra("phone").value,i=`
    <span style="padding-right:5px;" class="open-profile-name">
        <img src="${i}" class="top-image-profile">
        <span class="routin-top-content">Editar</span>
    </span> 
    <span style="margin: 0px 10px 0px 0px;">${r}</span>`,n=`
    <span class="additional-info">${n?`<a alt="Call from your Phone" href="tel:${n}"><i class="styling-caller bi ${o<555?"bi-telephone-fill":"bi-skype"}"></i></a>`:""}
    </span>`;_.find(".sb-top > a.routin-top-tip").html(i),_.find(".sb-top > a.routin-calls-chat").html(n);let l=!1;if(_.find(".sb-top > a.routin-top-tip > span").on("click",function(){var t=S(this).next(".additional-info");l?t.hide():t.show(),l=!l}),S(".sb-list").prepend('<div class="load-more"><span id="load-more" ><i style="vertical-align:middle;font-size: var(--chat-text-size-1-0);" class="bi-arrow-up-circle"></i> </div>'),U.must_translate=SB_ADMIN_SETTINGS.translation&&T().language&&SB_ADMIN_SETTINGS["active-agent-language"]!=T().language,U.must_translate){var c=[];let s=[],i=[];for(var d=0;d<e.messages.length;d++){var u=e.messages[d];"bot"!=u.get("user_type")&&u.message&&(c.push(u.message),s.push(u.id),i.push(u.get("user_type")))}c.length&&E.dialogflow.translate(c,SB_ADMIN_SETTINGS["active-agent-language"],t=>{if(t)for(var e=0;e<t.length;e++){var a=SBChat.conversation.getMessage(s[e]);a&&(a.set("translation",t[e].translatedText),g.find(`[data-id="${s[e]}"]`).replaceWith(a.getCode(!0)),g.find(`[data-id="${s[e]}"] .sb-menu`).prepend(`<li data-value="original">${I(SBF.isAgent(i[e])?"View translation":"View original message")}</li>`))}})}var o=_.find("#conversation-department"),n=(o.length&&(i=o.find(`[data-id="${e.get("department")}"]`),o.find(" > p").attr("data-value",i.data("value")).html(i.html())),_.find("#conversation-agent")),i=(n.length&&(o=n.find(`[data-id="${e.get("agent_id")}"]`),n.find(" > p").attr("data-value",o.data("id")).html(o.html())),[1,2].includes(t)?t=0:t,s==t||6==s||S(j).find(".sb-search-btn").sbActive()||(a.find(`[data-value="${t}"]`).click(),a.find("ul").sbActive(!1)),C&&this.mobileOpenConversation(),f.length||s!=t&&(0!=s||1!=t&&6!=t)&&(6!=s||0!=t)||y.prepend(N.getListCode(e).replace("<li",'<li class="sb-active"')),f.sbActive(!0),b&&this.scrollTo(),e.get("busy"));if(i&&_.find(".sb-editor > .sb-agent-label").html(`<span data-agent="${i.id}" style="border-radius: 10px 10px 0px 0px;position: absolute;bottom: calc(100% - -1px);background: #006eff;color: #ffffff;padding: 4px 10px;font-size: var(--chat-text-size-9);left: 4px;right: 4px;text-align: center;"><b>${i.first_name} ${i.last_name}</b> ${I("was viewing the conversation.")} <i class="bi-check-all" style="vertical-align: middle;"></i></span>`),this.tags.update(e.details.tags),this.notes.update(e.details.notes),this.attachments(),SB_ADMIN_SETTINGS["smart-reply"]){let t=e.getLastUserMessage();H.html(""),(t=t&&t.payload("sb-human-takeover")?e.getLastUserMessage(t.get("index")):t)&&(E.dialogflow.smart_reply_data=!1,E.dialogflow.smartReply(t.message))}for(d=e.messages.length-1;0<d;d--){var p=e.messages[d].get("payload");let t=!1;if(p&&"rich-messages"in p)for(var h in p["rich-messages"]){h=p["rich-messages"][h];if("rating"==h.type){_.find(".sb-profile-list > ul").append(`<li data-id="rating"><i class="sb-icon bi-${1==h.result.rating?"hand-thumbs-up-fill":"hand-thumbs-down-fill"}"></i><span>${I("User rating")}</span></li>`),t=!0;break}}if(t)break}T().getConversations(function(t){_.find(".sb-user-conversations").html(T().getConversationsCode(t))}),g.sbLoading(!1)}):(SBChat.clear(),y.find("li").sbActive(!1),g.sbLoading(!1)),a||this.updateUserDetails(),_.find(".sb-board").removeClass("sb-no-conversation"),D.updateUsersActivity(),this.startRealTime(),SBF.getURL("conversation")!=e&&mt("?conversation="+e)}},positionList(){var t=document.querySelectorAll("ul.sorting-by-last-message li"),t=(Array.from(t).sort((t,e)=>new Date(e.getAttribute("data-time")).getTime()-new Date(t.getAttribute("data-time")).getTime()).forEach((t,e)=>{t.style.order=e}),document.querySelector("ul.sorting-by-last-message"));t.style.display="flex",t.style.flexDirection="column"},populate:function(t,e,a){this.openConversation(t,e,a)},populateList:function(t){let e="",a=(w=[],t);a=a.sort(function(t,e){return new Date(e.creation_time).getTime()-new Date(t.creation_time).getTime()});for(var s=0;s<a.length;s++)e+=this.getListCode(a[s]),w.push(a[s]);""==e&&(e=`<p class="sb-no-results">${I("No conversations found.")}</p>`),y.html(e),y.css("position","relative"),y.css("bottom","15px"),N.positionList(),this.updateMenu(),SBF.event("SBAdminConversationsLoaded",{conversations:t})},update:function(){var t;this.busy||0!=G.eq(0).find("p").attr("data-value")||(this.busy=!0,SBF.ajax({function:"get-new-conversations",datetime:this.datetime_last_conversation},n=>{if(this.busy=!1,n.length){let e="",a="";var o=SBChat.conversation?SBChat.conversation.id:-1;let s,i=!1;var r=[];this.datetime_last_conversation=n[0].creation_time,D.updateMenu();for(var l=0;l<n.length;l++)if(!r.includes(n[l].conversation_id)){var c=n[l],d=c.conversation_status_code,u=c.user_id,p=c.conversation_id,h=o==p;let t=this.getListCode(c,null);var g=y.find(`[data-conversation-id="${p}"]`),f=g.index(),b=g.length,v=SBF.null(n[l].payload)?{}:JSON.parse(n[l].payload),m=c.message;40<m.length&&(m=m.substring(0,40)+"...",c.message=m),h?(t=t.replace("<li",'<li class="sb-active"'),b?(c.message&&g.replaceWith(t),w[f].conversation_status_code=d,this.setReadIcon(d)):i=!0):b&&(w[f]=c,y.find(`[data-conversation-id="${p}"]`).remove()),u in k||(k[u]=new SBUser({id:u,first_name:c.first_name,last_name:c.last_name,profile_image:c.profile_image,user_type:c.user_type})),h&&b||(2==d?(e+=t,w.unshift(c)):0!=d&&1!=d||(0==(s=y.find('[data-conversation-status="2"]').last()).length?e+=t:(w.splice(s.index()+1,0,c),a+=t)),u==T().id&&T().getConversations(function(t){_.find(".sb-user-conversations").html(T().getConversationsCode(t))}),SBF.event("SBAdminNewConversation",{conversation:c})),T()&&("event"in v&&"update-user"==v.event||k[u].type!=c.user_type)&&T().update(()=>{this.updateUserDetails(),k[T().id]=T()}),""==c.message&&""==c.attachments||N.newMsgTop(n[l],"add"),SBChat.tab_active||2!=c.conversation_status_code||SBF.isAgent(c.message_user_type)&&!("preview"in v)||SBF.null(c.message)&&SBF.null(c.attachments)&&!("preview"in v)||(this.desktop_notifications&&(m=[c.first_name+" "+c.last_name,D.userProfileImage(c.profile_image)],g=("preview"in v?v.preview:"notfimy").replace(/\*(.*?)\*/g,"*$1*").replace(/_(.*?)_/g,"_$1_").replace(/~(.*?)~/g,"~$1~").replace(/```(.*?)```/g,"```\n$1\n```").replace(/`(.*?)`/g,"`$1`").replace(/(.*?)/g,"$1"),SBChat.desktopNotification(m[0],g,m[1],p,u)),this.flash_notifications&&SBChat.flashNotification(),SBChat.audio&&["a","c","ic","ag"].includes(SB_ADMIN_SETTINGS.sounds)&&SBChat.audio.play()),r.push(p)}e&&y.prepend(e),a&&S(a).insertAfter(s),i&&this.scrollTo(),this.updateMenu()}}),(SB_ADMIN_SETTINGS["assign-conversation-to-agent"]||SB_ACTIVE_AGENT.department)&&(t=y.find(" > li").map(function(){return S(this).attr("data-conversation-id")}).get()).length&&SBF.ajax({function:"check-conversations-assignment",conversations_ids:t,agent_id:!!SB_ADMIN_SETTINGS["assign-conversation-to-agent"]&&SB_ACTIVE_AGENT.id,department:SB_ACTIVE_AGENT.department},t=>{if(t)for(var e=0;e<t.length;e++)y.find(`[data-conversation-id="${t[e]}"]`).remove()}))},updateMenu:function(){var t=y.find('[data-conversation-status="2"]').length,e=G.eq(0);let a=e.find(" > a").find(" > p span");var s=document.getElementById("floatingElement");100==t||this.menu_count_ajax?(e=e.find("li.sb-active").data("value"),this.menu_count_ajax=!0,SBF.ajax({function:"count-conversations",status_code:0==e?2:e},t=>{a.html(`(${t})`)})):(s?s.querySelector(".notif").textContent=t:((e=document.createElement("div")).id="floatingElement",e.style.cssText="position: relative; top: 10px; margin: auto; display: flex; justify-content: center; z-index: 33;",(s=document.createElement("small")).className="notif",s.style.cssText="font-size: medium; padding: 6px 10px; border-radius: 30px;",s.textContent=t,e.appendChild(s),document.getElementById("sb-conversations").appendChild(e)),document.getElementById("sb-conversations").querySelector("div").style.visibility=0===t?"hidden":"visible")},messageMenu:function(t){var e=`<li style="padding: 6px 15px; line-height:20px" data-value="read-text"> <i class="bi-volume-up-fill"></i> ${I("Leer")}</li>`;return`
				<i class="sb-menu-btn bi-three-dots"></i>
				<ul style="right: 0rem;padding: .4rem;" class="message-menu sb-menu">
					${d&&!SB_ADMIN_SETTINGS.supervisor&&SB_ADMIN_SETTINGS["allow-agent-delete-message"]||SB_ADMIN_SETTINGS.supervisor&&SB_ADMIN_SETTINGS["allow-supervisor-delete-message"]?`<li style="padding: 6px 15px; line-height:20px" data-value="delete"><i class="bi-trash"></i> ${I("Delete")}</li><hr>`:""}
					${e}
				</ul>`},updateUserDetails(){var t,e;T()&&(t=S(".sb-top > a"),e=15<(e=T().name).length?e.slice(0,15)+"...":e,t.find("span").eq(1).html(e),_.find(".sb-user-details .sb-profile").setProfile(),R.populate(T(),_.find(".sb-profile-list")))},setReadIcon(t){let e=2==t;_.find('.sb-top [data-value="read"], .sb-top [data-value="unread"]').sbActive([0,1,2].includes(parseInt(t))).attr("data-value",e?"read":"unread").attr("data-sb-tooltip",I(e?"Mark as read":"Mark as unread")).each(function(){S(this).find("i").attr("class",e?"i-details bi-check-lg":"i-details bi-check-all"),S(this).find("span").text(I(e?"Mark as read":"Mark as unread"))})},getListCode:function(t,e){let s=(t=t instanceof SBConversation?{message:(i=t.getLastMessage()).message,attachments:i.attachments,user_id:t.get("user_id"),conversation_id:t.id,conversation_status_code:t.get("conversation_status_code"),conversation_source:t.get("source"),label:t.get("label"),profile_image:t.get("profile_image"),first_name:t.get("first_name"),last_name:t.get("last_name"),creation_time:t.get("creation_time"),payload:t.get("payload")}:t).message,a=[];var i=/[{,+0-9]+@s\.whatsapp\.net/g;if(40<(s=(s=(s=(s=(s=(s=s.replace(/- /g," ")).replace(/[\[\]"\,}]/g,"")).replace(i,"")).replace(/\[buttons\s+options="([^"]+)"\s+message="([^"]+)"\]/g,'<i class="bi-file-text" data-options="$1" data-message="$2"></i>')).replace(/\[card[^\]]*\]/g,'<i class="bi-file-text"></i>')).replace(//g,"").replace(//g,"  ")).length){let t=0,e=0;for(const d of s.split(" ")){if(5<=e||40<t+d.length+1)break;a.push(d),t+=d.length+1,e++}s=a.join(" ")+"..."}t.label,SBF.admin_set("whatsapp-cloud")["cloud-active"];i.test(s)&&(a=s.replace(/^.*?]/,""));var i=new SBMessage,n=!SBF.null(t.title);t.payload.includes("preview")&&(r=JSON.parse(t.payload.replace("\\'","'")))&&"preview"in r&&(s=r.preview);const o={"*":"strong","~":"s","```":"code"};if(Object.keys(o).forEach(a=>{var t=new RegExp(`\\${a}(.*?)\\`+a,"g");s.includes(a)&&(s=s.replace(t,(t,e)=>`<${o[a]}>${e}</${o[a]}>`))}),SBF.null(e)&&(e=t.conversation_status_code),!s&&!SBF.null(t.attachments)){var r=JSON.parse(t.attachments);if(Array.isArray(r)){const u=/\.(jpg|jpeg|png|webp|mp4)\b/g,p=/\.(docx?|xlsx?|pdf)\b/g,h=/\.(mp3|ogg)\b/g;var l=r.filter(t=>u.test(t)),c=r.filter(t=>p.test(t)),r=r.filter(t=>h.test(t));let t="",e="",a="";0<l.length&&(t='<i class="bi-box"></i> '+I("Media")+": "+(1<l.length?"+"+(l.length-1):l.length)),0<c.length&&(e='<i class="bi-file-text"></i> '+I("Doc")+": "+(1<c.length?"+"+(c.length-1):c.length)),0<r.length&&(a='<i class="bi-mic-fill vertical-align"></i> '+I("Voice")+": "+(1<r.length?"+"+(r.length-1):r.length)),(t||e||a)&&(s=[t,e,a].filter(Boolean).join(" "))}}return`<li style="
			 " data-user-id="${t.user_id}" data-conversation-id="${t.conversation_id}"  data-time="${new Date(t.creation_time).getTime()}" data-conversation-status="${e}"${SBF.null(t.conversation_source)?"":` data-conversation-source="${t.conversation_source}"`}>
			<small class="source-conversation-icon"><img id="conversation-source-icon" class="source-buttons" src="../media/apps/${t.conversation_source}.svg">
      </small>
			<div class="sb-profile client-status"><img class="client-icon-status sb-icon tags-${t.label} bi-crosshair loading="lazy" src="${t.profile_image}">
    
			<h3 class="sb-name${n?" sb-custom-name":""}">${n?t.title:t.first_name+" "+t.last_name} </h3>
			<div class="sb-info-conversations" style="min-width: 60px;text-align:right;flex: auto;font-size: .75rem;letter-spacing: .3px;margin: -2px 0px;">${SBF.beautifyTime(t.creation_time)}</div>
			</div>
			<div>
			<a class="phone-number" style="color:inherit">${t.phone}</a>
			</div>
			<p class="message-received" style="max-width:calc(100% - 145px);">${i.strip(s).replace(/_/g," ")}</p>
			<div class="conversation-bar">

			<div class="no-read-icon sb-hide" style="margin: 0px 1px;">
				<svg width="20" height="20" viewBox="0 0 24.5 24.5" data-name="Flat Color"
					xmlns="http://www.w3.org/2000/svg" class="icon flat-color">
					<circle cx="12" cy="12" r="10" class="check-circle" />
					<path
						d="M11 16a1 1 0 0 1-.71-.29l-3-3a1 1 0 1 1 1.42-1.42l2.29 2.3 4.29-4.3a1 1 0 0 1 1.42 1.42l-5 5A1 1 0 0 1 11 16Z"
						class="check-inside" />
				</svg>
			</div>
		</div>
		</div>
		</li> 
		`},newMsgTop(t=!1,e){document.querySelectorAll("ul.sorting-by-last-message li");var a=S(".sb-scroll-area");t&&((w=this.getUniqueChat(w,"user_id")).slice().sort((t,e)=>new Date(e.creation_time).getTime()-new Date(t.creation_time).getTime()).forEach((t,e)=>{S(`.sorting-by-last-message li[data-conversation-id='${t.conversation_id}']`).attr("style",`
				  transition: all .5s ease;
          webkit-transition: all .5s ease;
				  width:-webkit-fill-available;width:-moz-available;
          
				`)}),0<a.scrollTop())&&"add"===e&&requestAnimationFrame(()=>this.newMsgTop(t,e))},getUniqueChat:function(t,a){let s=[];return t.filter(function(e){s.findIndex(t=>t[a]==e[a])<=-1&&s.push(e)}),s},startRealTime:function(){SBPusher.active||(this.stopRealTime(),this.real_time=setInterval(()=>{this.update(),this.updateCurrentURL()},1e4),SBChat.startRealTime())},stopRealTime:function(){clearInterval(this.real_time),SBChat.stopRealTime()},timeZoneList:function(){Intl.supportedValuesOf("timeZone");var t=document.querySelector("#zones"),e=Intl.DateTimeFormat().resolvedOptions().timeZone;if(Intl.supportedValuesOf){t.innerHTML+="";for(const s of Intl.supportedValuesOf("timeZone"))t.innerHTML+=`<option ${e==s?"selected":""}>${s}</option>`}else{var a=new Option("Your browser does not support Intl.supportedValuesOf().",null,!0,!0);a.disabled=!0,t.options.add(a)}},transcript:function(t,e=!1){if(!("email"!=e||T()&&T().get("email")))return!1;SBF.ajax({function:"transcript",conversation_id:t},t=>{"email"==e?SBChat.sendEmail(SB_ADMIN_SETTINGS["transcript-message"],[[t,t]],!0):window.open(t)})},typing:function(t){t?(SBChat.user_online||D.setActiveUserStatus(!0),this.user_typing||(_.find(".sb-conversation .sb-top > .sb-labels").append('<span class="sb-status-typing" style="font-size: var(--chat-text-size-7);">'+I("Typing")+"</span>"),this.user_typing=!0)):this.user_typing&&(_.find(".sb-conversation .sb-top .sb-status-typing").remove(),this.user_typing=!1)},scrollTo:function(){var t=y.find(".sb-active"),t=t.length?t[0].offsetTop:0;y.parent().scrollTop(t-(C?120:70))},search:function(t){t&&bt(t,(t,e)=>{(st=1)<t.length?SBF.ajax({function:"search-conversations",search:t},t=>{N.populateList(t),S(e).sbLoading(!1),this.scrollTo(),this.is_search=!0}):(t=N.filters(),at=1,SBF.ajax({function:"get-conversations",status_code:t[0],tag:t[3]},t=>{N.populateList(t),S(e).sbLoading(!1),this.is_search=!1}))})},updateCurrentURL:function(t=!1){t?this.ucurl(t):SBChat.user_online&&T()&&T().getExtra("current_url")&&SBF.ajax({function:"current-url"},t=>{t&&this.ucurl(t)})},ucurl(t){var e=T().getExtra("current_url");t=t.replace("https://","").replace("http://","").replace("www.","").replace(/\/$/,""),_.find('.sb-profile-list [data-id="current_url"] label').attr("data-value",t).html(t),e&&(e.value=t,T().setExtra("current_url",e))},assignDepartment:function(t,e,a){SBF.ajax({function:"update-conversation-department",conversation_id:t,department:e,message:SBChat.conversation.getLastMessage().message},t=>{a(t)})},assignAgent:function(t,e,a=!1){SBF.ajax({function:"update-conversation-agent",conversation_id:t,agent_id:e,status_code:6,message:SBChat.conversation.getLastMessage().message},t=>{a&&a(t)})},setActiveDepartment:function(t){var e,a;SBChat.conversation&&SBChat.conversation.get("department")==t||(a=(e=_.find("#conversation-department")).find(`[data-id="${t}"]`),e.find(" > p").attr("data-value",a.data("value")).html(a.html()).next().sbActive(!1),SBChat.conversation.set("department",t),"agent"==SB_ACTIVE_AGENT.user_type&&SB_ACTIVE_AGENT.department&&SB_ACTIVE_AGENT.department!=t&&(y.find(`[data-conversation-id="${SBChat.conversation.id}"]`).remove(),N.clickFirst()),A("Department updated. The agents have been notified."))},setActiveAgent:function(t){var e=_.find("#conversation-agent"),a=e.find(`[data-id="${t}"]`);SBChat.conversation.set("agent_id",t),e.find(" > p").attr("data-value",a.data("value")).html(a.html()).next().sbActive(!1),"agent"!=SB_ACTIVE_AGENT.user_type||SB_ADMIN_SETTINGS["assign-conversation-to-agent"]&&!t||(y.find(`[data-conversation-id="${SBChat.conversation.id}"]`).remove(),N.clickFirst()),t&&A("Agent assigned. The agent has been notified.")},mobileOpenConversation:function(){_.find(".sb-admin-list").sbActive(!1),_.find(".sb-conversation").sbActive(!0),i.addClass("sb-hide")},mobileCloseConversation:function(){y.find("li.sb-active").sbActive(!1),_.find(".sb-admin-list").sbActive(!0),_.find(".sb-conversation").sbActive(!1),i.removeClass("sb-hide"),window.history.replaceState({},document.title,SBF.URL())},clickFirst:function(){y.find("li:first-child").length?(y.find("li:first-child").click(),N.scrollTo()):_.find(".sb-board").addClass("sb-no-conversation")},savedReplies:function(t,e){var a=e.charAt(t.selectionStart-1);if("/"==a&&(SBChat.editor_listening=!0),SBChat.editor_listening&&" "==a){var s=e.substr(e.lastIndexOf("/")+1).replace(" ","");SBChat.editor_listening=!1;for(var i=0;i<B.length;i++)if(B[i]["reply-name"]==s)return void S(t).val(e.substr(0,e.lastIndexOf("/"))+B[i]["reply-text"])}},attachments:function(){if(O.length){var e=SBChat.conversation.getAttachments();let t="";for(var a=0;a<e.length;a++){var s=e[a][0].slice(0,20);t+=`<a href="${e[a][1]}" class="bg-attachment" target="_blank"><i class="sb-icon bi-file-earmark-arrow-down"></i>${s+"..."} </a>`}S(O).html(""==t?"":`<h3>${I("Attachments")}</h3><div class="sb-list-items sb-list-links sb-list-icon">${t}</div>`),ft(O,160)}},filters:function(){for(var t=[],e=0;e<G.length;e++)t.push(G.eq(e).find("li.sb-active").data("value"));return(t[1]||t[3])&&(t[0]="all"),t},notes:{busy:!1,add:function(t,e,a,s,i=!1){let n=S("#alertdate").val();var o,r=S("#zones").val();n=""!=n&&(SBF.getTimezoneOffset(r)==(new Date).getTimezoneOffset()?n:new Date(n).toUTCString()),-1<navigator.userAgent.indexOf("Firefox")&&((o=new Date(n)).setHours(o.getHours()-3),n=""!=n&&(SBF.getTimezoneOffset(r)==(new Date).getTimezoneOffset()?moment.utc(n).format():new Date(n).toUTCString())),SBF.ajax({function:"add-note",conversation_id:t,user_id:e,name:a,message:s,alert:n,time_zone:r,status:!n},t=>{i&&i(t),S("#alertdate").val("")})},update:function(e,a=!1){if(P.length){let t="";for(var s=P.find(" > div"),i=0;i<e.length;i++){var n=e[i];t+=`<div data-id="${n.id}"><span class="sb-note-title">${n.name} ${SB_ACTIVE_AGENT.id==n.user_id?'<i class="sb-delete-note bi-x-lg"></i>':""}</span>${n.alert||n.time_zone?`<small class="note-alert-text" style="margin: 0px 6px;">${n.alert?SBF.localTime(n.alert,n.time_zone):""}${null!=n.time_zone?" "+n.time_zone:""}</small>`:""}<span class="note-content">${n.message}</span></div>`}a?s.append(t):s.html(t),s.attr("style","display: flex; flex-direction: column-reverse;"),P.find(".bi-chevron-down").remove(),ft(P,155),this.busy=!1}},delete:function(t,e,a=!1){this.busy||(this.busy=!0,SBF.ajax({function:"delete-note",conversation_id:t,note_id:e},t=>{this.busy=!1,a&&a(t)}))},readmore:function(t,e){return t.length<=e?(S(".dots").hide(),t):t.slice(0,e)+`<span class="more" style="display:none">${t.slice(e,t.length)}</span><span class="dots">...</span>`}},tags:{busy:!1,list:!1,update:function(e){if(q.length){let t="";for(var a=q.find(" > div"),s=0;s<e.length;s++)t+=`<span>${e[s]}</span>`;a.html(t),this.busy=!1}},getAll:function(t=[]){let e="";for(var a=0;a<this.list.length;a++)t.includes(this.list[a])||(e+=`<span>${this.list[a]}</span>`);return e}},showDirectMessageBox:function(t,e=[]){var a="email"==t;SBForm.clear(u),u.find(".sb-direct-message-users").val(e.length?e.join(","):""),u.find(".sb-bottom > div").html(""),u.find(".sb-top-bar > div:first-child").html(I("Broadcast "+("sms"==t?"text message":t))),u.find(".sb-loading").sbLoading(!1),u.find(".sb-direct-message-subject").sbActive(a).find("input").attr("required",a),u.attr("data-type",t),"email"!==t&&"sms"!==t?(u.find(".sb-selector").removeClass("sb-hide"),(new Metatemplate).init("#user-template-form"),"template"===u.find(".sb-select").val()&&u.find(".sb-select").val(null)):(u.find(".sb-selector").addClass("sb-hide"),S(".sb-bulk-sender").addClass("sb-hide"),S(".sb-direct-message-hide").removeClass("sb-hide")),u.find(".sb-select").on("change",function(){S(this).find(".active-bulk-sender").is(":selected")?(S(".sb-bulk-sender").removeClass("sb-hide"),S(".sb-direct-message-hide").addClass("sb-hide")):(u.find(".sb-selector").addClass("sb-hide"),S(".sb-bulk-sender").addClass("sb-hide"),S(".sb-direct-message-hide").removeClass("sb-hide"))}),u.sbShowLightbox()}},R={getAll:function(t){return SBForm.getAll(t)},get:function(t){return SBForm.get(t)},set:function(t,e){return SBForm.set(t,e)},getUserExtra:function(e){SBF.ajax({function:"get-user-extra",user_id:e},t=>{this.getUserExtra(e,response)})},show:function(a){F(),T(new SBUser({id:a})),T().update(()=>{this.populate(T(),r.find(".sb-profile-list")),r.find(".sb-profile").setProfile(),T().getConversations(t=>{var e=T().type;SBF.isAgent(e)&&this.agentData(),r.find(".sb-user-conversations").html(T().getConversationsCode(t)),r.find(".sb-top-bar [data-value]").sbActive(!1),SBF.null(T().get("email"))||r.find(".sb-top-bar [data-value=email]").sbActive(!0),T().getExtra("phone")&&SB_ADMIN_SETTINGS.sms&&r.find(".sb-top-bar [data-value=sms]").sbActive(!0),this.boxClasses(r,e),r.attr("data-user-id",T().id).sbShowLightbox(),F(!1,!1),SBF.event("SBProfileBoxOpened",{user_id:a})}),k[a]=T(),SBF.getURL("user")!=a&&mt("?user="+a)})},showEdit:function(e){if(!(e instanceof SBUser))return SBF.error("User not of type SBUser","SBUsers.showEdit"),!1;{var a=g.find("#password input"),s=e.type,i=g.find("#user_type select");g.removeClass("sb-user-new").attr("data-user-id",e.id),g.find(".sb-top-bar .sb-save").html('<i class="bi-check-lg"></i>'+I("Save changes")),g.find(".sb-profile").setProfile(),g.find(".sb-custom-detail").remove(),g.find("input,select,textarea").removeClass("sb-error");let t="";var n,o=g.find(".sb-additional-details [id]").map(function(){return this.id}).get().concat(["facebook-id","ip","os","current_url","country_code","browser_language","browser"]);for(n in e.extra)o.includes(n)||(t+=`<div id="${n}" data-type="text" class="sb-input sb-custom-detail"><span>${I(e.extra[n].name)}</span><input type="text"></div>`);g.find(".sb-additional-details .sb-edit-box").append(t),this.populateEdit(e,g),this.updateRequiredFields(s),"admin"==SB_ACTIVE_AGENT.user_type&&SBF.isAgent(s)&&i.html(`<option value="agent">${I("Agent")}</option><option value="admin"${"admin"==s?" selected":""}>${I("Admin")}</option>`),a.val()&&a.val("********"),this.boxClasses(g,s),g.sbShowLightbox(),SBF.event("SBProfileEditBoxOpened",{user_id:e.id})}},populate:function(s,i){var t,e,a=["first_name","last_name","password","profile_image"];let n="";for(o in i.hasClass("sb-profile-list")&&SBChat.conversation&&(t=SBChat.conversation.get("source"),e=SBChat.conversation.get("label"),n=this.profileRow("conversation-id",SBChat.conversation.id,I("Conversation ID")),SBF.null(e)?n+=this.profileRow("conversation-label","Unknown",I("Label")):n+=this.profileRow("conversation-label",e,I("Client status")),SBF.null(t)?n+=this.profileRow("conversation-source","Unknown"):n+=this.profileRow("conversation-source",{fb:"Facebook",ww:"Whatsmeow",wx:"waweb",wa:"WhatsApp",tm:"Text message",ig:"Instagram",tg:"Telegram",tk:"Tickets",wc:"WeChat",em:"Email",tw:"Twitter",bm:"Google"}[t]||t,I("Source"))),"admin"!=SB_ACTIVE_AGENT.user_type&&a.push("token"),s.details)a.includes(o)||(n+=this.profileRow(o,s.get(o)));if(s.isExtraEmpty())SBF.ajax({function:"get-user-extra",user_id:s.id},t=>{for(var e=1;e<t.length;e++){var a=t[e].slug;s.setExtra(a,t[e]),n+=this.profileRow(a,t[e].value,t[e].name)}i.html(`<ul>${n}</ul>`),ft(i,56)});else{for(var o in s.extra){var r=s.getExtra(o);n+=this.profileRow(o,r.value,r.name)}i.html(`<h3 class="sb-user-details-info">${I("User information")}</h3><ul>${n}</ul>`),ft(i,56)}S("#change-conversation-source").change(function(t){const e=t.target.value;t=`${STMBX_URL}/media/apps/${e}.svg`,S("#conversation-source-icon").attr("src",t),SBF.ajax({function:"update-conversation-source",conversation_id:SBChat.conversation.id,source:e},t=>{A("Required reload"),SBChat.update(),S("#change-conversation-source").val(e)}),t="sb-icon bi-"+e;S('.sb-profile-list [data-id="conversation-source"] i').attr("class",t)}),S("#change-conversation-labels").change(function(t){var e,a;"Unknown"!==t.target.value&&(e=t.target.options[t.target.selectedIndex].text,a="sb-icon bi-crosshair tags-"+t.target.value,S('.sb-profile-list [data-id="conversation-label"] i').attr("class",a),S(`[data-user-id="${T().id}"] .bi-crosshair`).attr("class",a),S(`[data-user-id="${T().id}"] #label-name`).text(e)),R.updateLabel(t.target.value)}),S("#CstBtn a").click(function(t){var e=S(this).attr("id"),a=I(SBF.admin_set("label-names")[e]+" "),s="sb-icon bi-kanban-fill tags-"+e;S('.sb-profile-list [data-id="conversation-label"] i').attr("class",s),S(`[data-user-id="${T().id}"] .bi-kanban-fill`).attr("class",s),S(`[data-user-id="${T().id}"] #label-name`).text(a),R.updateLabelUI(e,a,s),R.updateLabel(e)})},updateLabelUI:function(t,e,a){S(`[data-user-id="${T().id}"] .bi-crosshair`).attr("class",a),S(`[data-user-id="${T().id}"] #label-name`).text(e)},getLabel:function(t){SBF.ajax({function:"get-clientStatus-conversations",conversation_id:SBChat.conversation.id,label:t},t=>{"status-client"==a.active_report&&a.initReport("status-client")})},updateLabel:function(t){SBF.ajax({function:"update-clientStatus-conversations",conversation_id:SBChat.conversation.id,label:t},t=>{"status-client"==a.active_report&&a.initReport("status-client")})},profileRow:function(t,a,e=t){if(""==a)return"";var s={id:"person-vcard","conversation-label":"tag","conversation-source":"tickets","conversation-id":"person-vcard",full_name:"person-bounding-box",email:"envelope",phone:"phone",user_type:"person-bounding-box",last_activity:"calendar",creation_time:"calendar",token:"shuffle",currency:"currency-exchange",location:"pin-map",country:"flag",address:"app",city:"app",postal_code:"app",os:"person-workspace",current_url:"radar",timezone:"clock"};let i=`<i class="sb-icon bi-${t in s?s[t]:"app"}"></i>`,n,o=!1;switch(t){case"last_activity":case"creation_time":a=SBF.beautifyTime(a);break;case"user_type":a=SBF.slugToString(a);break;case"country_code":case"language":case"browser_language":i=`<img src="${STMBX_URL}/media/flags/${a.toLowerCase()}.png" />`;break;case"browser":(n=a.toLowerCase()).includes("chrome")?o="chrome":n.includes("edge")?o="edge":n.includes("firefox")?o="firefox":n.includes("opera")?o="opera":n.includes("safari")&&(o="safari");break;case"os":(n=a.toLowerCase()).includes("windows")?o="windows":n.includes("mac")||n.includes("apple")||n.includes("ipad")||n.includes("iphone")?o="apple":n.includes("android")?o="android":n.includes("linux")?o="linux":n.includes("ubuntu")&&(o="ubuntu");break;case"conversation-source":case"browser":case"os":case"conversation-source":o=a.toLowerCase(),a=`<select disabled style="background: transparent;border-color: transparent;" id="change-conversation-source">
                                <option  value="tk" ${"Tickets"==a?"selected":""} value>Live Chat</option>
                                <option value="ww" ${"Whatsmeow"==a?"selected":""} value>WhatsApp QR</option>
                                <option value="wx" ${"waweb"==a?"selected":""} value>WhatsApp Web</option>                                
                                <option value="wa" ${"WhatsApp"==a?"selected":""} value>WhatsApp API</option>
                                <option   hidden value="tg" ${"Telegram"==a?"selected":""} value>Telegram</option>
                                <option  hidden value="bm" ${"Google"==a?"selected":""} value>Google</option>
                                <option  hidden value="tm" ${"Text message"==a?"selected":""} value>Text message</option>
                                <option hidden value="un" ${"Unknown"==a?"selected":""} value>Facebook</option>                                
                                <option hidden value="ig" ${"Instagram"==a?"selected":""} value>Instagram</option>
                                <option hidden value="wc" ${"WeChat"==a?"selected":""} value>WeChat</option>
                                <option hidden value="em" ${"Email"==a?"selected":""} value>Email</option>
                                <option  hidden value="tw" ${"Twitter"==a?"selected":""} value>Twitter</option>
                             </select>`,o&&"Unknown"!==a&&(i=`<img src="${STMBX_URL}/media/${"conversation-source"==t?"apps":"devices"}/${o}.svg" />`);break;case"conversation-label":var r=a,l=gt;let e="";Array.isArray(l)&&l.forEach(function(t){e+=`<option value="${t}" ${a===t?"selected":""}>${I(SBF.get_value(t)+" ")}</option>`});l=`class="sb-invisible sb-icon bi-kanban-fill tags-${r}"`;a=`<select style="visibility:hidden;background: transparent; border-color: transparent;" id="change-conversation-labels">
            <option value='unknown'>${I("Client status")}</option> ${e} </select>`,i=`<i ${l}></i>`}return`<li data-id="${t}">${i}<span>${I(SBF.slugToString(e))}</span><label style="overflow-wrap: break-word">${a}</label></li>`},populateEdit:function(s,t){t.find(".sb-details .sb-input").each((t,e)=>{this.set(e,s.details[S(e).attr("id")])}),t.find(".sb-additional-details .sb-input").each((t,e)=>{var a=S(e).attr("id");a in s.extra?this.set(e,s.extra[a].value):this.set(e,"")})},clear:function(t){SBForm.clear(t)},errors:function(t){return SBForm.errors(t.find(".sb-details"))},showErrorMessage:function(t,e){SBForm.showErrorMessage(t,e)},agentData:function(){let i=`<div class="sb-title">${I("Feedback rating")}</div><div class="sb-rating-area sb-loading"></div>`,n=r.find(".sb-agent-area");n.html(i),SBF.ajax({function:"get-rating"},t=>{var e,a,s;i=0==t[0]&&0==t[1]?`<p class="sb-no-results">${I("No ratings yet.")}</p>`:(e=t[0]+t[1],a=100*t[0]/e,s=100*t[1]/e,`<div><div>${I("Helpful")}</div><span data-count="${t[0]}" style="width: ${Math.round(2*a)}px"></span><div>${a.toFixed(2)} %</div></div><div><div>${I("Not helpful")}</div><span data-count="${t[1]}" style="width: ${Math.round(2*s)}px"></span><div>${s.toFixed(2)} %</div></div><p class="sb-rating-count">${e} ${I("Ratings")}</p>`),n.find(".sb-rating-area").html(i).sbLoading(!1)})},boxClasses:function(t,e=!1){S(t).removeClass("sb-type-admin sb-type-agent sb-type-lead sb-type-user sb-type-visitor").addClass(`${0!=e?"sb-type-"+e:""} sb-agent-`+SB_ACTIVE_AGENT.user_type)},updateRequiredFields:function(t){var e=SBF.isAgent(t);g.find("#password input").prop("required",e),g.find("#email input").prop(e||"user"==t||"lead"==t)}},U={dialog:$,open_popup:!1,must_translate:!1,is_logout:!1,conversations:N,users:D,settings:M,profile:R,apps:E};function xt(){SBF.ajax({function:"get-conversations"},t=>{0==t.length&&_.find(".sb-board").addClass("sb-no-conversation"),N.populateList(t),C&&_.find(".sb-admin-list").sbActive(!0),SBF.getURL("conversation")?(_.sbActive()||i.find(".sb-admin-nav #sb-conversations").click(),N.openConversation(SBF.getURL("conversation"))):C||SBF.getURL("user")||SBF.getURL("setting")||SBF.getURL("report")||SBF.getURL("area")&&"conversations"!=SBF.getURL("area")||N.clickFirst(),N.startRealTime(),N.datetime_last_conversation=SB_ADMIN_SETTINGS["now-db"],F(!1)}),SBPusher.initServiceWorker(),SB_ADMIN_SETTINGS["push-notifications"]&&SBPusher.initPushNotifications()}window.SBAdmin=U,S(document).ready(function(){if(d=S(".sb-admin"),i=d.find("> .sb-header"),_=d.find(".sb-area-conversations"),j=_.find(".sb-admin-list"),y=j.find(".sb-scroll-area ul"),G=j.find(".sb-select"),o=d.find(".sb-area-users"),l=o.find(".sb-table-users"),h=o.find(".sb-menu-users"),r=d.find(".sb-profile-box"),g=d.find(".sb-profile-edit-box"),f=d.find(".sb-area-settings"),v=f.find(".sb-automations-area"),X=v.find(".sb-conditions"),W=v.find(" > .sb-select"),m=v.find(" > .sb-tab > .sb-nav > ul"),x=d.find(".sb-area-reports"),b=f.find(".sb-articles-area"),V=b.find(".sb-article-categories select"),z=b.find(".sb-article-parent-category select"),tt=_.find(".sb-replies"),et=_.find(".sb-status-chat"),K=d.find(".sb-lightbox-overlay"),typeof STMBX_URL!=ut&&STMBX_URL.substr(0,STMBX_URL.indexOf("-content")-3),P=_.find(".sb-panel-notes"),q=_.find(".sb-panel-tags"),O=_.find(".sb-panel-attachments"),u=d.find(".sb-direct-message-box"),p=d.find(".sb-dialogflow-intent-box"),H=_.find(".sb-editor > .sb-suggestions"),window.onpopstate=function(){d.sbHideLightbox(),C&&_.sbActive()&&_.find(".sb-conversation").sbActive()&&N.mobileCloseConversation(),SBF.getURL("user")?(o.sbActive()||i.find(".sb-admin-nav #sb-users").click(),R.show(SBF.getURL("user"))):SBF.getURL("area")?i.find(".sb-admin-nav #sb-"+SBF.getURL("area")).click():SBF.getURL("conversation")?(_.sbActive()||i.find(".sb-admin-nav #sb-conversations").click(),N.openConversation(SBF.getURL("conversation"))):SBF.getURL("setting")?(f.sbActive()||i.find(".sb-admin-nav #sb-settings").click(),f.find("#tab-"+SBF.getURL("setting")).click()):SBF.getURL("report")&&(x.sbActive()||i.find(".sb-admin-nav #sb-reports").click(),x.find("#"+SBF.getURL("report")).click())},SBF.getURL("area")&&setTimeout(()=>{i.find(".sb-admin-nav #sb-"+SBF.getURL("area")).click()},300),typeof SB_ADMIN_SETTINGS==ut){let s=d.find(".sb-intall");void S(d).on("click",".sb-submit-installation",function(){if(!L(this)){let a=!1;var t=s.find("#first-name").length;if(SBForm.errors(s))a=t?"All fields are required. Minimum password length is 8 characters. Be sure you have entered a valid email.":"All fields are required.";else if(t&&s.find("#password input").val()!=s.find("#password-check input").val())a="The passwords do not match.";else{let e=window.location.href.replace("/admin","").replace(".php","").replace(/#$|\/$/,"");e.includes("?")&&(e=e.substr(0,e.indexOf("?"))),S.ajax({method:"POST",url:e+"/include/ajax.php",data:{function:"installation",details:S.extend(SBForm.getAll(s),{url:e})}}).done(t=>{if(0!=(t=JSON.parse(t))){if(!0===(t=t[1]))return void setTimeout(()=>{window.location.href=e+"?refresh=true"},1e3);switch(t){case"connection-error":a="Routin.bot cannot connect to the database. Please check the database information and try again.";break;case"missing-details":a="Missing database details! Please check the database information and try again.";break;case"missing-url":a="We cannot get the plugin URL.";break;default:a=t}}else a=t;!1!==a&&(SBForm.showErrorMessage(s,a),S("html, body").animate({scrollTop:0},500)),S(this).sbLoading(!1)})}!1!==a&&(SBForm.showErrorMessage(s,a),S("html, body").animate({scrollTop:0},500),S(this).sbLoading(!1))}})}else if(d.length&&(F(),d.removeAttr("style"),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"))&&d.addClass("sb-pwa"),ot&&typeof caches!==ut&&caches.delete("sb-pwa-cache"),!d.find(" > .sb-rich-login").length)){SB_ADMIN_SETTINGS.pusher?(SBPusher.active=!0,SBPusher.init(()=>{SBPusher.presence(1,()=>{D.updateUsersActivity()}),SBPusher.event("update-conversations",()=>{N.update(),SBChat.update()},"agents"),SBPusher.event("set-agent-status",t=>{t.agent_id==SB_ACTIVE_AGENT.id&&D.setActiveAgentStatus("online"==t.status)},"agents"),xt()})):(xt(),setInterval(function(){D.updateUsersActivity()},1e4)),D.table_extra=l.find("th[data-extra]").map(function(){return S(this).attr("data-field")}).get(),S(window).on("beforeunload",function(){T()&&SBF.ajax({function:"on-close"})}),S(window).keydown(function(t){var e=t.which;let a=!1;if([13,27,46].includes(e)){if(d.find(".sb-dialog-box").sbActive()){var s=d.find(".sb-dialog-box");switch(e){case 46:case 27:s.find(".sb-cancel").click();break;case 32:case 13:s.find("info"!=s.attr("data-type")?".sb-confirm":".sb-close").click()}a=!0}else if([46].includes(e)&&_.sbActive()){if(_.find(".sb-editor textarea").is(":focus"))return;var i=_.find(" > div > .sb-conversation");i.find('.sb-top [data-value="'+(3==i.attr("data-conversation-status")?"delete":"archive")+'"]').click(),a=!0}else[46,27].includes(e)&&(d.find(".sb-lightbox").sbActive()?(d.sbHideLightbox(),a=!0):(i=d.find(".sb-search-btn.sb-active")).length&&(i.find("i").click(),a=!0));a&&t.preventDefault()}}),S(document).on("click keydown mousemove",function(){SBF.debounce(function(){SBChat.tab_active||SBF.visibilityChange(),SBChat.tab_active=!0,clearTimeout(dt),dt=setTimeout(()=>{SBChat.tab_active=!1},1e4)},"#3",8e3)});var n=0;document.onpaste=function(t){var e,a,s,i,t=t.clipboardData.items[0];0===t.type.indexOf("image")&&((e=new FileReader).onload=function(t){},a=new FormData,s=`screenshot-${n++}.png`,i=t.getAsFile(),a.append("fname",s),a.append("file",i),jQuery.ajax({url:STMBX_URL+"/include/upload.php",cache:!1,contentType:!1,processData:!1,data:a,type:"POST",success:function(t){SBF.uploadResponse(t)}}),e.readAsDataURL(t.getAsFile()))},S(document).ready(function(){S(i).on("click",".help-center",function(){d.find(".sb-updates-box").sbShowLightbox()})}),typeof Notification===ut||"all"!=SB_ADMIN_SETTINGS["desktop-notifications"]&&"agents"!=SB_ADMIN_SETTINGS["desktop-notifications"]||SB_ADMIN_SETTINGS["push-notifications"]||(N.desktop_notifications=!0),"all"!=SB_ADMIN_SETTINGS["flash-notifications"]&&"agents"!=SB_ADMIN_SETTINGS["flash-notifications"]||(N.flash_notifications=!0),rt.getDate()!=SBF.storage("admin-clean")&&setTimeout(function(){SBF.ajax({function:"cron-jobs"}),SBF.storage("admin-clean",rt.getDate())},1e4),S(d).on("click",".bi-chevron-down",function(){var t=S(this).sbActive(),e=t?S(this).parent().data("height")+"px":"";S(this).html(I(t?"View more":"Close")),S(this).parent().find("> div, > ul").css({height:e,"max-height":e}),S(this).sbActive(!t)}),S(d).on("click",".sb-popup-close",function(){d.sbHideLightbox()}),d&&(S(document).on("click",function(t){S(t.target).closest(".sb-menu-mobile").length||(S(".sb-menu-mobile > i").removeClass("sb-active"),S(".open-profile").removeClass("sb-hide"))}),S(d).on("click",".sb-menu-mobile > i",function(){S(this).toggleClass("sb-active"),U.open_popup=S(this).parent()}),S(d).on("click",".sb-menu-mobile a",function(){S(this).closest(".sb-menu-mobile").find(" > i").sbActive(!1)}),S(d).on("click",".sb-menu-wide,.sb-nav",function(){S(this).toggleClass("sb-active")}),S(d).on("click",".sb-menu-wide > ul > li, .sb-nav > ul > li",function(t){var e=S(this).parent().parent();return e.find("li").sbActive(!1),e.find("> div:not(.sb-menu-wide):not(.sb-btn)").html(S(this).html()),e.sbActive(!1),e.find("> .sb-menu-wide").length&&e.closest(".sb-scroll-area").scrollTop(e.next()[0].offsetTop-(d.hasClass("sb-header-hidden")?70:130)),t.preventDefault(),!1}),S(d).find(".sb-admin-list .sb-scroll-area, main > div > .sb-scroll-area,.sb-area-settings > .sb-tab > .sb-scroll-area,.sb-area-reports > .sb-tab > .sb-scroll-area").on("scroll",function(){var t=S(this).scrollTop();e.last<t-10&&e.header?(d.addClass("sb-header-hidden"),e.header=!1):t+10<e.last&&!e.header&&!e.always_hidden&&(d.removeClass("sb-header-hidden"),e.header=!0),e.last=t}),S(d).on("click",".sb-search-btn i, .sb-filter-btn i",function(){S(this).parent().sbActive()?(S(".sb-top").css("top","+=0px"),S(this).parent().hasClass("sb-filter-btn")&&S(".sb-search-btn, .inbox, .non-hover").addClass("sb-hide"),S(this).hasClass("bi-search")?S(this).removeClass("bi-search").addClass("bi-x-lg"):S(this).hasClass("bi-x-lg")?S(this).removeClass("bi-x-lg").addClass("bi-filter"):S(this).hasClass("bi-filter")&&S(this).removeClass("bi-filter").addClass("bi-filter-circle")):(e.always_hidden=!1,y.parent().scrollTop()<10&&(d.removeClass("sb-header-hidden"),S(this).parent().hasClass("sb-filter-btn")&&S(".sb-search-btn, .inbox, .non-hover").removeClass("sb-hide"),S(this).hasClass("bi-filter-circle")?S(this).removeClass("bi-filter-circle").addClass("bi-filter"):S(this).hasClass("bi-filter")?S(this).removeClass("bi-filter").addClass("bi-x-lg"):S(this).hasClass("bi-x-lg")&&S(this).removeClass("bi-x-lg").addClass("bi-search")))}),S(d).on("click","#open-modal-button",function(){console.log("open",d.find(".sb-send-template-box")),d.find(".sb-send-template-box").sbShowLightbox()}),S(d).on("click","#meta-broadcast-button",function(){console.log("open"),d.find(".meta-broadcast-box").sbShowLightbox()}),S(d).on("click",".sb-top .sb-btn-back",function(){N.mobileCloseConversation()}),S(document).ready(function(){var t=S(l),e=t.find("th:first-child"),a=t.find("tr");function s(){S(window).width()<555?(e.addClass("sb-invisible"),e.css("margin","-20px"),a.addClass("sb-active")):(e.removeClass("sb-invisible"),e.css("margin",""),a.removeClass("sb-active"))}s(),S(window).resize(s)}),S(l).on("click","th:first-child",function(){S(this).parent().toggleClass("sb-active")})),S(_).on("click","> .sb-btn-collapse, .collapse",function(){S(this).toggleClass("sb-active"),_.find(S(this).hasClass("sb-left")?".sb-admin-list":".sb-top").toggleClass("sb-active")}),S(_).on("click",".sb-conversation",function(){S(".sb-admin-list, .sb-btn-collapse.sb-left.bi-arrow-left-short.sb-active").removeClass("sb-active")}),S(_).on("click",".sb-list, .sb-editor",function(){S(".sb-admin-list, .sb-btn-collapse.sb-left.bi-arrow-left-short.sb-active").removeClass("sb-active"),S(".sb-user-details.sb-top.sb-active, .sb-top.sb-active").removeClass("sb-active")}),S(i).on("click"," .sb-admin-nav a",function(){var t=S(this).attr("id");switch(i.find(".sb-admin-nav a").sbActive(!1),d.find(" > main > div").sbActive(!1),d.find("."+S(this).attr("id").replace("sb-","sb-area-")).sbActive(!0),S(this).sbActive(!0),SBF.deactivateAll(),t){case"sb-conversations":C||SBF.getURL("conversation")||N.clickFirst(),N.update(),N.startRealTime(),D.stopRealTime();break;case"sb-users":D.startRealTime(),N.stopRealTime(),D.init||(F(),nt=it=1,SBF.ajax({function:"get-users",user_types:["user","visitor","lead"],extra:D.table_extra},t=>{D.populate(t),D.updateMenu(),D.init=!0,D.datetime_last_user=SBF.dateDB("now"),F(!1)}));break;case"sb-settings":M.init||(F(),SBF.ajax({function:"get-all-settings"},t=>{if(t){var e,a=t["external-settings-translations"];for(e in M.initHTML(t),M.translations.translations=Array.isArray(a)&&!a.length?{}:a,delete t["external-settings-translations"],t)M.set(e,t[e])}M.initPlugins(),F(!(M.init=!0))})),D.stopRealTime(),N.stopRealTime();break;case"sb-reports":x.sbLoading()&&S.getScript(STMBX_URL+"/vendor/moment.min.js",()=>{S.getScript(STMBX_URL+"/vendor/daterangepicker.min.js",()=>{S.getScript(STMBX_URL+"/vendor/chart.min.js",()=>{a.initDatePicker(),a.initReport("conversations"),x.sbLoading(!1)})})}),D.stopRealTime(),N.stopRealTime()}var t=t.substr(3),e=SBF.getURL("area");"reports"==t&&S("#"+a.active_report).click(),e!=t&&("conversations"==t&&!SBF.getURL("conversation")||"users"==t&&!SBF.getURL("user")||"settings"==t&&!SBF.getURL("setting")||"reports"==t&&!SBF.getURL("report"))&&mt("?area="+t)}),S(i).on("click",".sb-profile",function(){S(this).next().toggleClass("sb-active")}),S(i).on("click",'[data-value="logout"],.logout',function(){U.is_logout=!0,SBF.ajax({function:"on-close"}),D.stopRealTime(),N.stopRealTime(),SBF.logout()}),S(i).on("click",'[data-value="edit-profile"],.edit-profile',function(){F();let t=new SBUser({id:SB_ACTIVE_AGENT.id});t.update(()=>{T(t),_.find(".sb-board").addClass("sb-no-conversation"),y.find(".sb-active").sbActive(!1),R.showEdit(t)})}),S(i).on("click",'[data-value="status"]',function(){D.setActiveAgentStatus(!S(this).hasClass("sb-online"))}),S(i).find(".sb-account").setProfile(SB_ACTIVE_AGENT.full_name,SB_ACTIVE_AGENT.profile_image),S(y).on("click","li",function(){(new SBMessage).setLoad(30),N.openConversation(S(this).attr("data-conversation-id"),S(this).attr("data-user-id"),!1),SBF.deactivateAll()}),S(d).on("click",".sb-user-conversations li",function(){N.openConversation(S(this).attr("data-conversation-id"),T().id,S(this).attr("data-conversation-status"))}),S(_).on("click",".sb-top ul a",function(){let e=-1,t="The conversation will be ",a=S(this).attr("data-value");document.querySelectorAll("ul.sorting-by-last-message li");let s=SBChat.conversation.id;switch(a){case"inbox":e=0,t+="restored.";break;case"archive":t+="archived.",e=3;break;case"follow-up":t+="assigned for follow-up.",e=6;break;case"delete":t+="moved to the Bot container. Bot flow restarted.",e=4;break;case"empty-trash":e=5,t="The bot will permanently delete all conversations in the container, including their messages.";break;case"transcript":N.transcript(s,S(this).attr("data-action"));break;case"read":e=0,t+="marked as read.";break;case"unread":e=2,t+="marked as unread."}-1!=e&&$(t,"alert",function(){SBF.ajax({function:"update-conversation-status",conversation_id:s,status_code:e},()=>{if([0,3,4].includes(e))for(var t=0;t<w.length;t++)if(w[t].conversation_id==s){w[t].conversation_status_code=e;break}SB_ADMIN_SETTINGS["close-message"]&&3==e&&(SBF.ajax({function:"close-message",conversation_id:s,bot_id:SB_ADMIN_SETTINGS["bot-id"]}),SB_ADMIN_SETTINGS["close-message-transcript"])&&N.transcript(s,"email"),[0,2].includes(e)&&(y.find(".sb-active").attr("data-conversation-status",e),N.setReadIcon(e)),"inbox"!=a&&[0,2].includes(e)||(G.eq(0).find("li.sb-active").click(),G.eq(0).find("ul").sbActive(!1)),E.is("slack")&&[3,4].includes(e)&&SBF.ajax({function:"archive-slack-channels",conversation_user_id:SBChat.conversation.get("user_id")})}),SBChat.conversation&&SBChat.conversation.id==s&&SBChat.conversation.set("conversation_status_code",e)})}),S(function(){S(_).on("click",'ul.sorting-by-last-message li[data-conversation-status="2"]',function(){var t=S(this).attr("data-conversation-id");SBF.ajax({function:"update-conversation-status",conversation_id:t,status_code:0},function(){S(this).attr("data-conversation-status",0),y.find(".sb-active").attr("data-conversation-status",0),N.setReadIcon(0)});var t=S(this).find(".sb-name.span-profile-detail"),e=t.text();20<e.length&&t.text(e.slice(0,17)+"...")}),S(_).on("click",".sb-top .open-profile",function(){S([_.find(".sb-user-details"),this]).toggleClass("sb-active")})}),SBF.ajax({function:"saved-replies"},t=>{let e=`<p class="sb-no-results">${I("No saved replies found. Add new saved replies via Settings > Admin")}</p>`;if(Array.isArray(t)&&0<t.length&&t[0]["reply-name"]){e="",B=t;for(var a=0;a<t.length;a++)e+=`<li><div>${"/"+t[a]["reply-name"]}</div><div>${t[a]["reply-text"]}</div></li>`}tt.find(".sb-replies-list > ul").html(e).sbLoading(!1)}),S(_).on("click","#load-saved-replies",function(){tt.sbTogglePopup(this)}),S(tt).on("click",".sb-replies-list li",function(){SBChat.insertText(S(this).find("div:last-child").html()),SBF.deactivateAll(),d.removeClass("sb-popup-active")}),S(tt).on("input",".sb-search-btn input",function(){let s=S(this).val().toLowerCase();SBF.search(s,()=>{let t="";for(var e=!(1<s.length),a=0;a<B.length;a++)(e||B[a]["reply-name"].toLowerCase().includes(s)||B[a]["reply-text"].toLowerCase().includes(s))&&(t+=`<li><div>${B[a]["reply-name"]}</div><div>${B[a]["reply-text"]}</div></li>`);tt.find(".sb-replies-list > ul").html(t)})}),S(_).on("click","#set-status",function(){et.sbTogglePopup(this)}),S(j).find(".sb-scroll-area").on("scroll",function(){if(!lt&&!N.is_search&&vt(this,!0)&&st){let t=_.find(".sb-admin-list");var e=N.filters();lt=!0,t.append('<div class="sb-loading-global sb-loading"></div>'),SBF.ajax({function:"get-conversations",pagination:at,status_code:e[0],user_type:"agent",department:e[1],source:e[2],tag:e[3]},e=>{if(setTimeout(()=>{lt=!1},500),st=e.length,e.sort(function(t,e){return new Date(e.creation_time).getTime()-new Date(t.creation_time).getTime()}),st){let t="";for(var a=0;a<st;a++)t+=N.getListCode(e[a],"append"),w.push(e[a]);at++,y.append(t),N.positionList(),vt(this,!1,1e3)}t.find(" > .sb-loading").remove(),SBF.event("SBAdminConversationsLoaded",{conversations:e})})}}),S(document).on("SBMessageDeleted",function(){var t=SBChat.conversation.getLastMessage();0!=t?(t.details.conversation_id,new Date(t.details.creation_time).getTime(),N.newMsgTop(t.details,"add"),y.find("li.sb-active p").html(t.message),y.find("li.sb-active .sb-profile .sb-time").html(t.details.creation_time)):(N.newMsgTop({conversation_id:SBChat.conversation.id},"deleted"),y.find("li.sb-active").remove(),N.clickFirst(),N.scrollTo())}),S(document).on("SBMessageSent",function(t,e){let a=e.conversation_id;var s=y.find(`[data-conversation-id="${a}"]`);let i=I("Error. Message not sent to");var n=e.conversation,o=e.user,s=(e.message&&s.find("p").html(e.message),-1!=e.conversation_status_code&&(s.attr("data-conversation-status",e.conversation_status_code),N.updateMenu()),E.messenger.check(n)&&E.messenger.send(o.getExtra("facebook-id").value,n.get("extra"),e.message,e.attachments,e.message_id,t=>{t&&"error"in t&&$(i+" Messenger: "+t.error.message,"info")}),SBF.get_value(SBF.admin_set("rate-and-review")["rate-review"])),s=(E.whatsapp.check(n)&&E.whatsapp.send(E.whatsapp.activeUserPhone(o),"[rating]"===e.message?s:e.message,e.attachments,n.get("extra"),t=>{t&&!t.error?A("<i class='bi-wind'></i> Message ent successfully"):A("<i class='bi-send-exclamation'></i> Message could not be sent to API Cloud","warning")},t=>{A("<i class='bi-info-circle'></i> Failed to send message. Please try again later","warning"),console.error("Error sending message to WhatsApp:",t)}),SBF.get_value(SBF.admin_set("rate-and-review")["rate-review"])),s=(E.whatsmeow.check(n)&&(e.message_id,"[rating]"==e.message&&(e.message=s),E.whatsmeow.send(E.whatsapp.activeUserPhone(o),e.message,e.attachments,n.get("extra"),t=>{t.status?A("<i class='bi-whatsapp'></i> Message Sent to WhatsApp mobile"):A("<i class='bi-send-exclamation'></i> Message could not be sent. Please check your connection. ","warning")},t=>{A("<i class='bi-info-circle'></i> Error with WhatsApp API. Please check your connection. ","error")})),SBF.get_value(SBF.admin_set("rate-and-review")["rate-review"]));E.waweb.check(n)&&(e.message_id,"[rating]"==e.message&&(e.message=s),E.waweb.send(E.whatsapp.activeUserPhone(o),e.message,e.attachments,n.get("extra"),t=>{t.status?A("<i class='bi-whatsapp'></i> Message Sent to WhatsApp mobile"):A("<i class='bi-send-exclamation'></i> Message could not be sent. Please check your connection. ","warning")},t=>{A("<i class='bi-info-circle'></i> Error with WhatsApp API. Please check your connection. ","error")})),E.telegram.check(n)&&("[rating]"==e.message&&(e.message=s),E.telegram.send(n.get("extra"),e.message,e.attachments,t=>{"ok"in t&&t.ok||$(i+" Telegram: "+JSON.stringify(t),"info")})),E.twitter.check(n)&&("[rating]"==e.message&&(e.message=s),E.twitter.send(o.getExtra("twitter-id").value,e.message,e.attachments,t=>{!t||"event"in t?1<e.attachments.length&&A("Only the first attachment was sent to Twitter.","info"):$(JSON.stringify(t),"info")})),E.gbm.check(n)&&("[rating]"==e.message&&(e.message=s),E.gbm.send(o.getExtra("gbm-id").value,e.message,e.attachments,t=>{t[0]&&"error"in t[0]&&$(i+" Google: "+t[0].error.message,"info")})),SB_ADMIN_SETTINGS["smart-reply"]&&H.html(""),SB_ADMIN_SETTINGS["assign-conversation-to-agent"]&&SBF.null(n.get("agent_id"))&&N.assignAgent(a,SB_ACTIVE_AGENT.id,()=>{SBChat.conversation.id==a&&(SBChat.conversation.set("agent_id",SB_ACTIVE_AGENT.id),S(_).find("#conversation-agent > p").attr("data-value",SB_ACTIVE_AGENT.id).html(SB_ACTIVE_AGENT.full_name))})}),S(document).on("SBNewMessagesReceived",function(t,s){var i=s.get("payload");let n=_.find(".sb-conversation");var e=SBF.isAgent(s.get("user_type"));if(setTimeout(function(){n.find(".sb-top .sb-status-typing").remove()},300),SB_ADMIN_SETTINGS["smart-reply"]&&(e?SB_ADMIN_SETTINGS["smart-reply-agent-assistant"]&&E.dialogflow.smartReplyUpdate(s.message):E.dialogflow.smartReply(s.message)),U.must_translate){let e=SBChat.conversation.getMessage(s.id),a=n.find(`[data-id="${s.id}"]`);var o="original-message"in i&&i["original-message"];o?(e.set("translation",o),a.replaceWith(e.getCode(!0)),n.find(`[data-id="${s.id}"] .sb-menu`).prepend(`<li data-value="original">${I("View translation")}</li>`)):s.message&&E.dialogflow.translate([s.message],SB_ADMIN_SETTINGS["active-agent-language"],t=>{t&&(e.set("translation",t[0].translatedText),a.replaceWith(e.getCode(!0)),n.find(`[data-id="${s.id}"] .sb-menu`).prepend(`<li data-value="original">${I("View original message")}</li>`))})}if("queryResult"in i&&"fulfillmentMessages"in i.queryResult)for(var a=i.queryResult.fulfillmentMessages,r=0;r<a.length;r++)if("payload"in a[r]){var l=a[r].payload;if("department"in l){N.setActiveDepartment(l.department);break}if("agent"in l){N.setActiveAgent(l.agent);break}}"ErrorCode"in i&&$("Error. Message not sent to WhatsApp. Error message: "+i.ErrorMessage,"info"),"whatsapp-fallback"in i&&A("Message sent as text message."+("whatsapp-template-fallback"in i?" The user has been notified via WhatsApp Template notification.":"")),"whatsapp-template-fallback"in i&&!("whatsapp-fallback"in i)&&A("The user has been notified via WhatsApp Template notification."),e||SBChat.conversation.id!=s.get("conversation_id")||SBChat.user_online||D.setActiveUserStatus(),N.update()}),S(document).on("SBNewConversationCreated",function(){N.update()}),S(document).on("SBEmailSent",function(){A("The user has been notified by email.")}),S(document).on("SBSMSSent",function(){A("The user has been notified by text message.")}),S(document).on("SBNotificationsSent",function(t,e){A(`The user has been notified by email${e.includes("sms")?" and text message":""}.`)}),S(document).on("SBTyping",function(t,e){N.typing(e)}),S(j).on("input",".sb-search-btn input",function(){N.search(this)}),S(_).on("click",".sb-admin-list .sb-search-btn i",function(){SBF.searchClear(this,()=>{N.search(S(this).next())}),S(".non-hover, .sb-filter-btn").toggleClass("sb-hide"),S("#hideOnSearchClick").toggleClass("sb-hide")}),S("#hideOnSearchClick li:first-child, #hideOnSearchClick li:nth-child(2)").addClass("transition-opacity"),S(".bi-search").click(function(){var t=S("#hideOnSearchClick li:first-child"),e=S("#hideOnSearchClick li:nth-child(2)");t.css("opacity",0==t.css("opacity")?1:0),e.toggleClass("sb-invisible").css("margin-right",function(t,e){return"-43px"===e?"0px":"-43px"})}),S(_).on("click",".sb-admin-list .sb-select li",function(){let a=y.parent();L(a)||setTimeout(()=>{let e=N.filters();st=at=1,SBF.ajax({function:"get-conversations",status_code:e[0],department:e[1],agent:SB_ACTIVE_AGENT.id,source:e[2],tag:e[3]},t=>{N.populateList(t),_.find(".sb-conversation").attr("data-conversation-status",e[0]),t.length?C||(SBChat.conversation?(t=y.find(`[data-conversation-id="${SBChat.conversation.id}"]`)).length?t.sbActive(!0):e[0]==SBChat.conversation.get("conversation_status_code")&&y.prepend(N.getListCode(SBChat.conversation).replace("<li",'<li class="sb-active"')):(N.clickFirst(),N.scrollTo())):(_.find(".sb-board").addClass("sb-no-conversation"),SBChat.conversation=!1),a.sbLoading(!1)})},100)}),S(_).on("click",".sb-user-details .sb-scroll-area div.sb-profile, .routin-top-tip",function(){let t;S(this).hasClass("sb-profile")?t=y.find(".sb-active").attr("data-user-id"):S(this).hasClass("routin-top-tip")&&(t=S(this).attr("data-user-id")),T().id!=t&&T(k[t]),R.show(T().id)}),S(d).on("click",'.sb-profile-list [data-id="location"]',function(){$('<iframe src="https://maps.google.com/maps?q='+S(this).find("label").html().replace(", ","+")+'&output=embed"></iframe>',"map")}),S(d).on("click",'.sb-profile-list [data-id="address"], .sb-profile-list [data-id="city"], .sb-profile-list [data-id="country"]',function(){let t="",e="",a="";"address"===S(this).data("id")?(t=S(this).find("label").text(),e=S('.sb-profile-list [data-id="city"] label').text(),a=S('.sb-profile-list [data-id="country"] label').text()):"city"===S(this).data("id")?(t=S('.sb-profile-list [data-id="address"] label').text(),e=S(this).find("label").text(),a=S('.sb-profile-list [data-id="country"] label').text()):"country"===S(this).data("id")&&(t=S('.sb-profile-list [data-id="address"] label').text(),e=S('.sb-profile-list [data-id="city"] label').text(),a=S(this).find("label").text()),$(`<iframe src="https://maps.google.com/maps?q=${encodeURIComponent(`${t}, ${e}, `+a)}&output=embed"></iframe>`,"map")}),S(d).on("click",'.sb-profile-list [data-id="timezone"]',function(){SBF.getLocationTimeString(T().extra,t=>{F(!1),$(t,"info")})}),S(d).on("click",'.sb-profile-list [data-id="current_url"]',function(){var t=S(this).find("label");window.open(SBF.null(t.attr("data-value"))?t.html():t.attr("data-value"))}),S(d).on("click",'.sb-profile-list [data-id="conversation-source"]',function(t){var e=S(this).find("option:selected").html().toLowerCase();"whatsapp"!=e&&"whatsmeow"!=e&&"waweb"!=e||T().getExtra("phone")}),S(_).on("click",'.sb-menu [data-value="bot"]',function(){E.dialogflow.showCreateIntentBox(S(this).closest("[data-id]").attr("data-id"))}),S(p).on("click",'.sb-intent-add [data-value="add"]',function(){p.find("> div > .sb-type-text").last().after('<div class="sb-input-setting sb-type-text"><input type="text"></div>')}),S(p).on("click",'.sb-intent-add [data-value="previous"],.sb-intent-add [data-value="next"]',function(){for(var t=p.find(".sb-first input"),e=t.val(),a="next"==S(this).attr("data-value"),s=SBChat.conversation.getUserMessages(),i=s.length,n=0;n<i;n++)if(s[n].message==e&&(a&&n<i-1||!a&&0<n)){n+=a?1:-1,t.val(s[n].message),p.attr("data-message-id",s[n].id);break}}),S(p).on("click",".sb-send",function(){E.dialogflow.submitIntent(this)}),S(p).on("input",".sb-search-btn input",function(){E.dialogflow.searchIntents(S(this).val())}),S(p).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{E.dialogflow.searchIntents(S(this).val())})}),S(p).on("click","#sb-intent-preview",function(){E.dialogflow.previewIntent(p.find("#sb-intents-select").val())}),S(p).on("change","#sb-intents-select",function(){p.find(".sb-bot-response").css("opacity",S(this).val()?.5:1)}),S(_).on("click","#conversation-department li",function(t){let e=S(this).parent().parent();return S(this).data("value")==e.find(" > p").attr("data-value")||(SBChat.conversation?e.sbLoading()||$(`${I("All agents assigned to the new department will be notified. The new department will be")} ${S(this).html()}.`,"alert",()=>{let t=S(this).data("id");e.sbLoading(!0),N.assignDepartment(SBChat.conversation.id,t,()=>{N.setActiveDepartment(t),e.sbLoading(!1),e.find(" > p").attr("data-value",t)})}):S(this).parent().sbActive(!1),t.preventDefault(),!1)}),S(_).on("click","#conversation-agent li",function(t){let e=S(this).parent().parent(),a=S(this).data("id");return a==e.find(" > p").attr("data-value")||a==SB_ACTIVE_AGENT.id||(SBChat.conversation?e.sbLoading()||$(`${I("The new agent will be")} ${S(this).html()}.`,"alert",()=>{e.sbLoading(!0),N.assignAgent(SBChat.conversation.id,a,()=>{N.setActiveAgent(a),SBChat.conversation.set("conversation_status_code",6);var t=y.find(`[data-conversation-id="${SBChat.conversation.id}"]`),t=(t.attr("data-conversation-status","6"),t.find(".sb-status")),t=(t.length&&t.attr("data-sb-status","6"),w.findIndex(t=>t.id===SBChat.conversation.id));-1!==t&&(w[t].conversation_status_code=6),N.update(),N.updateMenu(),_.find(".sb-conversation-details").sbActive()&&N.updateConversationDetails(),e.sbLoading(!1)})}):S(e).addClass("sb-active sb-responsive-absolute-position"),t.preventDefault(),!1)}),P.on("click","> i",function(t){return d.find(".sb-notes-box").sbShowLightbox(),S.getScript("https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js").done(()=>{s()}).fail(()=>{S.getScript(STMBX_URL+"/vendor/moment.min.js",()=>{s()})}),t.preventDefault(),!1}),P.on("click",".sb-delete-note",function(){let e=S(this).parents().eq(1);N.notes.delete(SBChat.conversation.id,e.attr("data-id"),t=>{!0===t?e.remove():SBF.error(t)})}),P.on("click",".sb-note-contain",function(){var t=S(this).find(".note-content .more"),e=S(this).find(".note-content .dots");"none"==t.css("display")?t.show():t.hide(),"none"==t.css("display")?e.show():e.hide()}),S(d).on("click",".sb-add-note",function(){let e=S(this).parent().parents().eq(1).find("textarea"),a=e.val();0==a.length?SBForm.showErrorMessage(d.find(".sb-notes-box"),"Please write something..."):L(this)||N.notes.add(SBChat.conversation.id,SB_ACTIVE_AGENT.id,SB_ACTIVE_AGENT.full_name,a,t=>{Number.isInteger(t)?(S(this).sbLoading(!1),d.sbHideLightbox(),N.notes.update([{id:t,conversation_id:SBChat.conversation.id,user_id:SB_ACTIVE_AGENT.id,name:SB_ACTIVE_AGENT.full_name,message:a,alert:S("#alertdate").val(),time_zone:S("#zones").val(),status:!1}],!0),e.val(""),A("New note successfully added."),s()):SBForm.showErrorMessage(t)})}),q.on("click","> i",function(t){let e=S(d).find(".sb-tags-box"),a=e.find(".sb-tags-cnt"),s="",i=SBChat.conversation.details.tags,n='<i id="sb-add-tag" class="bi-plus-lg sb-btn-icon"></i>';for(var o=0;o<i.length;o++)s+=`<span class="sb-active">${i[o]}</span>`;return N.tags.list?a.html(s+N.tags.getAll(i)+n):(e.sbLoading(!0),SBF.ajax({function:"get-tags"},t=>{N.tags.list=t,a.html(s+N.tags.getAll(i)+n),e.sbLoading(!1)})),e.sbShowLightbox(),t.preventDefault(),!1}),S(document).on("click","#tags-container.tagged > span",function(){let e=S(this);e.text();var t=SBChat.conversation.id;SBF.ajax({function:"update-tags",conversation_id:t,tags:[null]},t=>{A(!0===t[0]?"The bot is deleting tags in database...":t),!0===t[0]&&(e.remove(),S(".sb-tags-box .sb-tags-cnt span.sb-active").remove())})}),S(d).on("click",".sb-tags-cnt > span",function(){S(this).toggleClass("sb-active")}),S(d).on("click","#sb-add-tag",function(){S('<input type="text">').insertBefore(this)}),S(d).on("click","#sb-save-tags",function(){if(!L(this)){let a=d.find(".sb-tags-box").find("span.sb-active,input").map(function(){return S(this).is("span")?S(this).html():S(this).val()}).toArray(),s=SBChat.conversation.id;SBF.ajax({function:"update-tags",conversation_id:s,tags:a},t=>{var e;S(this).sbLoading(!1),N.tags.list=t[1],!0===t[0]&&(N.tags.update(a),SBChat.conversation)&&s==SBChat.conversation.id&&(e=N.filters()[3],SBChat.conversation.set("tags",a),e)&&!a.includes(e)&&(y.find(`[data-conversation-id="${s}"]`).remove(),N.clickFirst()),d.sbHideLightbox(),A(!0===t[0]?"Tags have been successfully updated.":t)})}}),S(H).on("click","span",function(){SBChat.insertText(S(this).html()),H.html("")}),S(_).on("click",".sb-list .sb-menu > li",function(){let t=S(this).closest("[data-id]"),e=t.attr("data-id");var a=SBChat.conversation.getMessage(e).get("user_type"),s=S(this).attr("data-value");switch(s){case"delete":SBChat.user_online?SBF.ajax({function:"update-message",message_id:e,message:"",attachments:[],payload:{event:"delete-message"}},()=>{SBChat.conversation.deleteMessage(e),t.remove()}):SBChat.deleteMessage(e);break;case"translation":case"original":var i="translation"==s,n=SBF.isAgent(a);t.replaceWith(SBChat.conversation.getMessage(e).getCode(i)),_.find(`[data-id="${e}"] .sb-menu`).prepend(`<li data-value="${i?"original":"translation"}">${I(n&&!i||!n&&i?"View original message":"View translation")}</li>`)}}),S(_).on("click",".sb-filter-btn i",function(){S(this).parent().toggleClass("sb-active")}),SBF.getURL("user")&&(i.find(".sb-admin-nav #sb-users").click(),setTimeout(()=>{R.show(SBF.getURL("user"))},500)),S(l).on("click","th :checkbox",function(){l.find("td :checkbox").prop("checked",S(this).prop("checked"))}),S(l).on("click",":checkbox",function(){var t=o.find('[data-value="delete"]');l.find("td input:checked").length?t.removeAttr("style"):t.hide()}),S(h).on("click","li",function(){D.filter(S(this).data("type"))}),S(o).on("input",".sb-search-btn input",function(){D.search(this)}),S(o).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{D.search(S(this).next())})}),S(l).on("click","th:not(:first-child)",function(){var t=S(this).hasClass("sb-order-asc")?"DESC":"ASC";S(this).toggleClass("sb-order-asc"),S(this).siblings().sbActive(!1),S(this).sbActive(!0),D.sort(S(this).data("field"),t)}),S(l).parent().on("scroll",function(){!lt&&!D.search_query&&vt(this,!0)&&nt&&(lt=!0,o.append('<div class="sb-loading-global sb-loading sb-loading-pagination"></div>'),SBF.ajax({function:"get-users",pagination:it,sorting:D.sorting,user_types:D.user_types,search:D.search_query,extra:D.table_extra},e=>{if(setTimeout(()=>{lt=!1},500),nt=e.length){let t="";for(var a=0;a<nt;a++){var s=new SBUser(e[a],e[a].extra);t+=D.getRow(s),k[s.id]=s}it++,l.find("tbody").append(t),vt(this,!1,1e3)}o.find(" > .sb-loading-pagination").remove()}))}),S(g).on("click",".sb-delete",function(){$("This user will be deleted permanently including all linked data, conversations, and messages.","alert",function(){D.delete(T().id)})}),S(l).on("click","td:not(:first-child)",function(){R.show(S(this).parent().attr("data-user-id"))}),S(r).on("click",".sb-top-bar .sb-edit",function(){R.showEdit(T())}),S(o).on("click",".sb-new-user",function(){g.addClass("sb-user-new"),g.find(".sb-top-bar .sb-profile span").html(I("Add new user")),g.find(".sb-top-bar .sb-save").html('<i class="bi-check-lg"></i>'+I("Add user")),g.find("input,select,textarea").removeClass("sb-error"),"admin"==SB_ACTIVE_AGENT.user_type&&g.find("#user_type").find("select").html(`<option value="lead">${I("Lead")}</option><option value="agent">${I("Agent")}</option><option value="admin">${I("Admin")}</option>`),R.clear(g),R.boxClasses(g),R.updateRequiredFields("user"),g.sbShowLightbox()}),S(g).on("click",".sb-save",function(){if(!L(this)){let e=!!g.hasClass("sb-user-new"),a=g.attr("data-user-id");var t=R.getAll(g.find(".sb-details")),s=R.getAll(g.find(".sb-additional-details"));R.errors(g)?(R.showErrorMessage(g,SBF.isAgent(g.find("#user_type :selected").val())?"First name, last name, password and a valid email are required. Minimum password length is 8 characters.":g.hasClass("sb-user-new")?"First name, last name, and a valid email are required.":`First name and last name ${"user"==t.user_type[0]||"lead"==t.user_type[0]?"email":""} are required.`),S(this).sbLoading(!1)):SBF.ajax({function:e?"add-user":"update-user",user_id:a,settings:t,settings_extra:s},t=>{SBF.errorValidation(t,"duplicate-email")||SBF.errorValidation(t,"duplicate-phone")?(R.showErrorMessage(g,`This ${SBF.errorValidation(t,"duplicate-email")?"email":"phone number"} is already in use.`),S(this).sbLoading(!1)):(e&&(a=t,T(new SBUser({id:a}))),T().update(()=>{k[a]=T(),e?(R.clear(g),D.update()):(D.updateRow(T()),_.sbActive()&&N.updateUserDetails(),a==SB_ACTIVE_AGENT.id&&(SBF.loginCookie(t[1]),SB_ACTIVE_AGENT.full_name=T().name,SB_ACTIVE_AGENT.profile_image=T().image,i.find(".sb-account").setProfile())),S(this).sbLoading(!1),g.find(".sb-profile").setProfile(),A(e?"New user added":"User updated"),d.sbHideLightbox()}),SBF.event("SBUserUpdated",{new_user:e,user_id:a}))})}}),S(".sb-area-users").on("click","#csv_contacts",function(){S("#csvimport").click()}),S("#csvimport").on("change",function(t){var e=new FormData;e.append("csv",this.files[0]),e.append("function","csv-users-add"),event.preventDefault(),S.ajax({url:STMBX_URL+"/include/ajax.php",method:"POST",data:e,dataType:"json",contentType:!1,cache:!1,processData:!1,success:function(t){A(t.success),S("#csvimport").val("")},error:function(t,e,a){SBF.error("csv-users-add",a),S("#csvimport").val("")}})}),S(g).on("change","#user_type",function(){var t=S(this).find("option:selected").val();R.boxClasses(g,t),R.updateRequiredFields(t)}),S(r).on("click",".sb-user-conversations li",function(){N.open(S(this).attr("data-conversation-id"),S(this).find("[data-user-id]").attr("data-user-id"))}),S(r).on("click",".sb-start-qr-conversation",function(){N.open(-1,T().id),N.openConversation(-1,T().id),C&&N.mobileOpenConversation()}),S(r).on("click",".sb-start-tk-conversation",function(){N.open(-1,T().id),N.openConversation(-1,T().id),C&&N.mobileOpenConversation()}),S(r).on("click",".sb-start-conversation",function(){N.open(-1,T().id),N.openConversation(-1,T().id),C&&N.mobileOpenConversation(),SBChat.sendMessage(-1,!1,!1,!1),d.find(".sb-send-template-box").sbShowLightbox()}),S(r).on("click",".sb-top-bar [data-value]",function(){N.showDirectMessageBox(S(this).attr("data-value"),[T().id])}),S(o).on("click",".sb-top-bar [data-value]",function(){var t=S(this).data("value");let e=[];switch(l.find("tr").each(function(){S(this).find('td input[type="checkbox"]').is(":checked")&&e.push(S(this).attr("data-user-id"))}),t){case"message":case"email":case"sms":N.showDirectMessageBox(t,e);break;case"csv":D.csv();break;case"delete":if(e.includes(SB_ACTIVE_AGENT.id))return A("You cannot delete yourself.","error");$("The bot will delete all selected users and their related data, conversations, and messages permanently.","alert",()=>{D.delete(e),S(this).hide(),l.find("th:first-child input").prop("checked",!1)})}}),S(d).on("change",".sb-select",function(){console.log("sb-select change event triggered");var t=S(this).val();S(this).closest(".sb-direct-message-box").attr("data-type",t)}),S(d).on("click",".sb-send-direct-message",function(t){console.log("sb-send-direct-message click event triggered"),t.preventDefault();let s=S(this).closest(".sb-direct-message-box"),i=s.attr("data-type"),n=s.find(".sb-direct-message-subject input").val(),o=s.find("textarea").val(),r=s.find(".sb-direct-message-users").val().replace(/ /g,""),e=null;if(console.log("Type:",i),console.log("Subject:",n),console.log("Message:",o),console.log("User IDs:",r),"template"===i&&(e=(new Metatemplate).payload("#user-template-form"),console.log("Payload:",e)),!L(this))if("message"==i&&SBF.ajax({function:"direct-message",user_ids:r,message:o},t=>{S(this).sbLoading(!1);let e=SB_ADMIN_SETTINGS["notify-user-email"],a=SB_ADMIN_SETTINGS["sms-active-users"];if(SBF.errorValidation(t))return SBForm.showErrorMessage(s,"An error has occurred. Please make sure all user ids are correct.");(e||a)&&SBF.ajax({function:"get-users-with-details",user_ids:r,details:e&&a?["email","phone"]:[e?"email":"phone"]},t=>{e&&t.email.length?c(t.email,o,0,a?t.phone:[],"email",n):a&&t.phone.length?c(t.phone,o,0,[],"sms"):d.sbHideLightbox()}),A(SBF.slugToString(i)+" sent to all users.")}),"template"==i)console.log("Sending messages..."),SBF.ajax({function:"direct-message",user_ids:r,message:o,template:"template"===i,payload:e},t=>{if(console.log("Direct message response:",t),S(this).sbLoading(!1),SBF.errorValidation(t))return console.log("Error validation occurred"),SBForm.showErrorMessage(s,"An error has occurred. Please make sure all user IDs are correct.");if(t.template_phone)c(t.template_phone,e.BodyTemplate,0,[],"template");else{let e=SB_ADMIN_SETTINGS["notify-user-email"],a=SB_ADMIN_SETTINGS["sms-active-users"];(e||a)&&(console.log("Getting users with details..."),SBF.ajax({function:"get-users-with-details",user_ids:r,details:e&&a?["email","phone"]:[e?"email":"phone"]},t=>{console.log("Users with details response:",t),e&&t.email.length?c(t.email,o,0,a?t.phone:[],"email",n):a&&t.phone.length?c(t.phone,o,0,[],"sms"):d.sbHideLightbox()})),A(SBF.slugToString(i)+" sent to all users.")}});else{console.log("Type is not 'message', getting users with details...");let e="email"==i?"email":"phone";SBF.ajax({function:"get-users-with-details",user_ids:r,details:[e]},t=>{if(console.log("Users with details response:",t),!t[e].length)return S(this).sbLoading(!1),SBForm.showErrorMessage(s,"No users found.");c(t[e],o,0,[],"email"==i?"custom-email":"sms",n)})}}),SBF.getURL("setting")&&(i.find(".sb-admin-nav #sb-settings").click(),setTimeout(()=>{f.find("#tab-"+SBF.getURL("setting")).click()},300)),S(f).on("click"," > .sb-tab > .sb-nav [id]",function(){var t=S(this).attr("id").substr(4);SBF.getURL("setting")!=t&&mt("?setting="+t)}),S(f).on("click",'[data-type="upload-image"] .image',function(){J=this,d.find(".sb-upload-form-admin .sb-upload-files").click()}),S(f).on("click",'[data-type="upload-image"] .image > i',function(t){return S(this).parent().removeAttr("data-value").css("background-image",""),t.preventDefault(),!1}),S(f).on("click",".sb-repeater-add",function(){M.repeaterAdd(this)}),S(f).on("click",".repeater-item > i",function(){M.repeaterDelete(this)}),M.initColorPicker(),S(f).find('[data-type="color"]').focusout(function(){let t=S(this).closest(".input-color"),e=t.find("input").val();setTimeout(function(){t.find("input").val(""),t.find(".color-preview").css("background-color",e)},300),M.set(S(this).attr("id"),e)}),S(f).on("click",".sb-type-color .input i",function(t){S(this).parent().find("input").removeAttr("style").val("")}),S(f).on("click",".sb-color-palette span",function(){var t=S(this).hasClass("sb-active");S(this).closest(".sb-repeater").find(".sb-active").sbActive(!1),S(this).sbActive(!t)}),S(f).on("click",".sb-color-palette ul li",function(){S(this).parent().parent().attr("data-value",S(this).data("value")).find("span").sbActive(!1)}),S(f).on("click",'[data-type="select-images"] .input > div',function(){S(this).siblings().sbActive(!1),S(this).sbActive(!0)}),S(f).on("click",".sb-select-checkbox-input",function(){S(this).toggleClass("sb-active")}),S(f).on("click",".sb-select-checkbox input",function(){var t=S(this).closest("[data-type]");t.find(".sb-select-checkbox-input").val(M.get(t)[1].join(", "))}),S(f).on("click",".sb-save-changes",function(){M.save(this)}),S(f).on("change",'#user-additional-fields [data-id="extra-field-slug"], #saved-replies [data-id="reply-name"], [data-id="rich-message-name"]',function(){S(this).val(SBF.stringToSlug(S(this).val()))}),S(f).on("click","#timetable-utc input",function(){""==S(this).val()&&S(this).val(Math.round(rt.getTimezoneOffset()/60))}),S(f).on("click","#test-email-user .sb-btn, #test-email-agent .sb-btn",function(){var t=S(this).parent().find("input").val();t&&0<t.indexOf("@")&&!L(this)&&SBF.ajax({function:"send-test-email",to:t,email_type:"test-email-user"==S(this).parent().parent().attr("id")?"user":"agent"},()=>{$("Email successfully sent. Check your emails!","info"),S(this).sbLoading(!1)})}),S(f).on("click",".sb-timetable > div > div > div",function(){var t=S(this).closest(".sb-timetable"),e=S(this).sbActive();S(t).find(".sb-active").sbActive(!1),e?S(this).sbActive(!1).find(".sb-custom-select").remove():(e=S(t).find("> .sb-custom-select").html(),S(t).find(" > div .sb-custom-select").remove(),S(this).append(`<div class="sb-custom-select">${e}</div>`).sbActive(!0))}),S(f).on("click",".sb-timetable .sb-custom-select span",function(){var t=[S(this).html(),S(this).attr("data-value")];S(this).closest(".sb-timetable").find("> div > div > .sb-active").html(t[0]).attr("data-value",t[1]),S(this).parent().sbActive(!1)}),S(f).on("click","#system-requirements a",function(t){let a=d.find(".sb-requirements-box"),s="";return SBF.ajax({function:"system-requirements"},t=>{for(var e in t)s+=`<div class="sb-input"><span>${I(SBF.slugToString(e))}</span><div${t[e]?' class="sb-green"':""}>${t[e]?I("Success"):I("Error")}</div></div>`;F(!1),a.find(".sb-main").html(s),a.sbShowLightbox()}),a.sbActive(!1),F(!0),t.preventDefault(),!1}),S(f).on("click","#sb-path a",function(t){return SBF.ajax({function:"path"},t=>{$(t,"info")}),t.preventDefault(),!1}),S(f).on("click","#delete-leads a",function(t){return S(this).sbLoading()||$("All leads, including all the linked conversations and messages, will be deleted permanently.","alert",()=>{S(this).sbLoading(!0),SBF.ajax({function:"delete-leads"},()=>{$("Leads and conversations successfully deleted.","info"),S(this).sbLoading(!1)})}),t.preventDefault(),!1}),S(f).on("click","#dialogflow-smart-reply-generate a",function(t){if(!L(this))return SBF.ajax({function:"dialogflow-smart-reply-generate-conversations-data"},t=>{$("Conversations data successfully generated. Folder: "+t,"info"),S(this).sbLoading(!1)}),t.preventDefault(),!1}),S(f).on("click","#sb-export-settings a",function(t){if(!L(this))return SBF.ajax({function:"export-settings"},t=>{window.open(t),$(I("For security reasons, delete the settings file after downloading it. Close this window to automatically delete it. File location:")+`<pre>${t}</pre>`,"info",!1,"sb-export-settings-close","Settings exported"),S(this).sbLoading(!1)}),t.preventDefault(),!1}),S(f).on("click","#sb-import-settings a",function(t){if(!L(this))return J=this,Y=t=>{SBF.ajax({function:"import-settings",file_url:t},t=>{t?A("Settings successfully imported. Reload the admin area to apply the new settings."):$(t,"info"),S(this).sbLoading(!1)}),Y=!1},d.find(".sb-upload-form-admin .sb-upload-files").click(),t.preventDefault(),!1}),S(d).on("click","#sb-export-settings-close .sb-close",function(){SBF.ajax({function:"delete-file",path:d.find(".sb-dialog-box p pre").html()})});function s(){var t=moment();t.local(),S("#alertdate").val(t.format("MM/DD/YY hh:mm A")),N.timeZoneList()}function c(a,s,i=0,n=[],o,r=!1){let l="custom-email"==o?["send-custom-email","emails"," users with an email","direct-emails"]:"sms"==o?["whatsmeow-send-message","waweb-send-message","messages"," with a phone number","direct-sms"]:["create-email","emails"," with an email",!1];l="template"==o?["whatsapp-send-meta-template","template","users a phone number","direct-messages"]:l;var t=(new Metatemplate).payload("#user-template-form"),t=(t.to=a[i],"template"==o?{function:l[0],payload:t}:{function:l[0],to:a[i].value,recipient_id:a[i].id,sender_name:SB_ACTIVE_AGENT.full_name,sender_profile_image:SB_ACTIVE_AGENT.profile_image,subject:r,message:s,template:!1});SBF.ajax(t,t=>{var e=a.length;if(u.find(".sb-bottom > div").html(`${I("Sending")} ${l[1]}... ${i+1} / `+e),t||console.warn(t),!t?.error)return i<e-1?c(a,s,i+1,n,o,r):(n.length?c(n,s,0,[],"sms",!1):(d.sbHideLightbox(),l[3]&&SBF.ajax({function:"reports-update",name:l[3],value:s+" | "+e})),void A(1==e?"Message sent":`${SBF.slugToString(l[1])} sent to all users${l[2]}.`));132e3==t?.error.code||100==t?.error.code?SBForm.showErrorMessage(u,""+t?.error.message):$(""+t?.error.message,"info"),console.warn(t)})}function t(t,e,a){S.getScript(t).done(function(){e()}).fail(function(){a()})}t("/js/min/wa.js",function(){console.log("wa.js loaded and executed from /js/min/wa.js.")},function(){t("/js/source/wa.js",function(){console.log("wa.js loaded and executed from /js/source/wa.js.")},function(){console.error("Failed to load wa.js from both locations.")})}),S(document).ready(function(){S(document).on("click","#get-templates-api .sb-btn",function(t){t.preventDefault(),S.ajax({type:"GET",url:STMBX_URL+"/include/templates.php",success:function(t){$("Meta's WhatsApp Business API Cloud templates loaded successfully.","info")},error:function(t,e,a){$("Meta Business Manager configuration incomplete. Please provide the Business Manager User ID, save, and retry.","info")}})})}),S(f).on("click","#whatsapp-twilio-btn .sb-btn, #sms-btn .sb-btn, #wechat-btn .sb-btn, #twitter-callback .sb-btn, #gbm-webhook .sb-btn",function(t){var e=S(this).closest("[id]").attr("id");return $(`<code style=" margin: auto; word-break: break-word; text-align: center; font-size: .9rem; ">${STMBX_URL+("sms-btn"==e?"/include/api.php":"/apps/"+("wechat-btn"==e?"wechat":"twitter-callback"==e?"twitter":"gbm-webhook"==e?"gbm":"whatsapp")+"/post.php")+St().replace("&","?")}</code>`,"info"),!1}),S(f).on("click","#telegram-button .sb-btn",function(t){var e=f.find("#telegram-token input").val().trim();return t.preventDefault(),!(!e||L(this)||(SBF.ajax({function:"telegram-synchronization",token:e,cloud_token:St()},()=>{$("Telegram Synchronization completed.","info"),S(this).sbLoading(!1)}),1))}),S(f).on("click","#whatsapp-test-template .sb-btn",function(t){t.preventDefault();t=S(this).parent().find("input").val();if(t&&!L(this))return SBF.ajax({function:"whatsapp-send-template",phone:t},t=>{$(t&&("error"in t?t.error.message:"Message sent, check your WhatsApp!"),"info"),S(this).sbLoading(!1)}),!1}),S(f).on("click","#twitter-subscribe .sb-btn",function(t){return t.preventDefault(),L(this)||SBF.ajax({function:"twitter-subscribe",cloud_token:St()},t=>{$(!0===t?"Synchronization completed.":JSON.stringify(t),"info"),S(this).sbLoading(!1)}),!1}),S(f).on("click","#email-piping-sync a",function(t){L(this)||(SBF.ajax({function:"email-piping",force:!0},t=>{$(!0===t?"Syncronization completed.":t,"info"),S(this).sbLoading(!1)}),t.preventDefault())}),S(f).on("click","#tab-automations",function(){M.automations.get(()=>{M.automations.populate(),F(!1)},!0),F()}),S(v).on("click",".sb-add-condition",function(){M.automations.addCondition()}),S(v).on("change",".sb-condition-1 select",function(){M.automations.updateCondition(this)}),S(W).on("click","li",function(){M.automations.populate(S(this).data("value"))}),S(m).on("click","li",function(){M.automations.show(S(this).attr("data-id"))}),S(v).on("click",".sb-add-automation",function(){M.automations.add()}),S(m).on("click","li i",function(){$("The automation will be deleted permanently.","alert",()=>{M.automations.delete(this)})}),S(x).on("click",".sb-nav [id]",function(){var t=S(this).attr("id");a.active_report=!1,x.find("#sb-date-picker").val(""),x.attr("class","sb-area-reports sb-active sb-report-"+t),a.initReport(S(this).attr("id")),SBF.getURL("report")!=t&&mt("?report="+t)}),S(x).on("change","#sb-date-picker",function(){a.initReport(!1,S(this).val())}),SBF.getURL("report")&&(x.sbActive()||i.find(".sb-admin-nav #sb-reports").click(),setTimeout(()=>{x.find("#"+SBF.getURL("report")).click()},500)),S(d).on("click",".sb-language-switcher > i",function(){let t=S(this).parent(),e=t.find("[data-language]").map(function(){return S(this).attr("data-language")}).get(),a=d.find(".sb-languages-box"),s="";for(var i in e.push("en"),SB_LANGUAGE_CODES)e.includes(i)||(s+=`<div data-language="${i}"><img src="${STMBX_URL}/media/flags/${i}.png" />${I(SB_LANGUAGE_CODES[i])}</div>`);Z=t,a.attr("data-source",t.attr("data-source")),a.find(".sb-main").html(s),a.sbShowLightbox()}),S(d).on("click",".sb-language-switcher img",function(){var t=S(this).parent(),e=t.sbActive(),a=!e&&t.attr("data-language");switch(t.parent().attr("data-source")){case"articles":M.articles.show(!1,!1,a);break;case"automations":M.automations.show(!1,a);break;case"settings":var s=t.parent().find("[data-language].sb-active");M.translations.save(t,e?t.attr("data-language"):!!s.length&&s.attr("data-language")),M.translations.activate(t,a)}t.siblings().sbActive(!1),t.sbActive(!e)}),S(d).on("click",".sb-language-switcher span > i",function(){let t=S(this).parent(),e=t.attr("data-language");$(I("The {T} translation will be deleted.").replace("{T}",I(SB_LANGUAGE_CODES[e])),"alert",()=>{switch(t.parent().attr("data-source")){case"articles":M.articles.deleteTranslation(!1,e),M.articles.show();break;case"automations":M.automations.deleteTranslation(!1,e),M.automations.show();break;case"settings":M.translations.delete(t,e)}t.remove()})}),S(d).on("click",".sb-languages-box [data-language]",function(){var t=S(this).parents().eq(1),e=S(this).attr("data-language");switch(t.attr("data-source")){case"articles":M.articles.addTranslation(!1,e),M.articles.show(!1,!1,e);break;case"automations":M.automations.addTranslation(!1,!1,e),M.automations.show(!1,e);break;case"settings":M.translations.add(e)}d.sbHideLightbox()}),S(d).on("click",".sb-lightbox .sb-top-bar .sb-close",function(){d.sbHideLightbox()}),S(d).on("click",".sb-lightbox .sb-info",function(){S(this).sbActive(!1)}),S(d).on("click",".sb-dialog-box a",function(){var t=S(this).closest(".sb-lightbox");S(this).hasClass("sb-confirm")&&Q(),1==d.find(".sb-lightbox.sb-active").length&&K.sbActive(!1),U.open_popup=!1,t.sbActive(!1)}),S(d).on("click",".sb-menu-wide li, .sb-nav li",function(){S(this).siblings().sbActive(!1),S(this).sbActive(!0)}),S(d).on("click",".sb-nav:not(.sb-nav-only) li:not(.sb-tab-nav-title)",function(){var t=S(this).closest(".sb-tab"),e=S(t).find(" > .sb-content > div").sbActive(!1).eq(S(this).parent().find("li:not(.sb-tab-nav-title)").index(this));e.sbActive(!0),e.find("textarea").each(function(){S(this).autoExpandTextarea(),S(this).manualExpandTextarea()}),t.find(".sb-scroll-area").scrollTop(0)}),S(d).on("change",".sb-upload-form-admin .sb-upload-files",function(t){S(this).sbUploadFiles(function(t){"success"==(t=JSON.parse(t))[0]?("upload-image"==S(J).closest("[data-type]").data("type")&&S(J).attr("data-value",t[1]).css("background-image",`url("${t[1]}")`),Y&&Y(t[1])):console.log(t[1])})}),S(d).on("click",".sb-accordion > div > span",function(t){var e=S(this).parent(),a=S(e).sbActive();S(t.target).is("span")&&(e.siblings().sbActive(!1),e.sbActive(!a))}),S(d).on("mousedown",function(t){var e;!S(U.open_popup).length||(e=S(U.open_popup)).is(t.target)||0!==e.has(t.target).length||["sb-btn-saved-replies","bi-emoji-grin"].includes(S(t.target).attr("class"))||(e.hasClass("sb-popup")?e.sbTogglePopup():e.hasClass("sb-select")?e.find("ul").sbActive(!1):e.hasClass("sb-menu-mobile")?e.find("i").sbActive(!1):e.hasClass("sb-menu")?e.sbActive(!1):d.sbHideLightbox(),U.open_popup=!1)})}})}(jQuery),function(t,e){"object"==typeof exports?module.exports=e(t):"function"==typeof define&&define.amd?define("colors",[],function(){return e(t)}):t.Colors=e(t)}(this,function(t,c){function n(t,e,a,s,i){if("string"==typeof e){e=k.txt2color(e);B[a=e.type]=e[a],i=i!==c?i:e.alpha}else if(e)for(var n in e)t[a][n]=r(e[n]/_[a][n][1],0,1);return i!==c&&(t.alpha=r(+i,0,1)),o(a,s?t:c)}function o(t,e){var a,s,i=e||B,n=k,o=w.options,r=_,l=i.RND,c="",d={hsl:"hsv",rgb:t},u=l.rgb;if("alpha"!==t){for(var p in r)if(!r[p][p])for(c in t!==p&&(s=d[p]||"rgb",i[p]=n[s+"2"+p](i[s])),l[p]||(l[p]={}),a=i[p])l[p][c]=x(a[c]*r[p][c][1]);u=l.rgb,i.HEX=n.RGB2HEX(u),i.equivalentGrey=o.grey.r*i.rgb.r+o.grey.g*i.rgb.g+o.grey.b*i.rgb.b,i.webSave=f=v(u,51),i.webSmart=b=v(u,17),i.saveColor=u.r===f.r&&u.g===f.g&&u.b===f.b?"web save":u.r===b.r&&u.g===b.g&&u.b===b.b?"web smart":"",i.hueRGB=k.hue2RGB(i.hsv.h),e&&(i.background=(f=u,b=i.rgb,e=i.alpha,g=w.options.grey,(h={}).RGB={r:f.r,g:f.g,b:f.b},h.rgb={r:b.r,g:b.g,b:b.b},h.alpha=e,h.equivalentGrey=x(g.r*f.r+g.g*f.g+g.b*f.b),h.rgbaMixBlack=S(b,{r:0,g:0,b:0},e,1),h.rgbaMixWhite=S(b,{r:1,g:1,b:1},e,1),h.rgbaMixBlack.luminance=m(h.rgbaMixBlack,!0),h.rgbaMixWhite.luminance=m(h.rgbaMixWhite,!0),w.options.customBG&&(h.rgbaMixCustom=S(b,w.options.customBG,e,1),h.rgbaMixCustom.luminance=m(h.rgbaMixCustom,!0),w.options.customBG.luminance=m(w.options.customBG,!0)),h))}var h,g=i.rgb,f=i.alpha,b="luminance",e=i.background;return(h=S(g,{r:0,g:0,b:0},f,1))[b]=m(h,!0),i.rgbaMixBlack=h,(h=S(g,{r:1,g:1,b:1},f,1))[b]=m(h,!0),i.rgbaMixWhite=h,o.customBG&&((h=S(g,e.rgbaMixCustom,f,1))[b]=m(h,!0),h.WCAG2Ratio=(g=h[b],f=e.rgbaMixCustom[b],x(100*(f<=g?(g+.05)/(f+.05):(f+.05)/(g+.05)))/100),(i.rgbaMixBGMixCustom=h).luminanceDelta=y.abs(h[b]-e.rgbaMixCustom[b]),h.hueDelta=(f=e.rgbaMixCustom,g=h,255*(y.max(f.r-g.r,g.r-f.r)+y.max(f.g-g.g,g.g-f.g)+y.max(f.b-g.b,g.b-f.b))/765)),i.RGBLuminance=m(u),i.HUELuminance=m(i.hueRGB),o.convertCallback&&o.convertCallback(i,t),i}function v(t,e){var a,s,i={},n=e/2;for(s in t)a=t[s]%e,i[s]=t[s]+(n<a?e-a:-a);return i}function m(t,e){for(var e=e?1:255,a=[t.r/e,t.g/e,t.b/e],t=w.options.luminance,s=a.length;s--;)a[s]=a[s]<=.03928?a[s]/12.92:y.pow((a[s]+.055)/1.055,2.4);return t.r*a[0]+t.g*a[1]+t.b*a[2]}function S(t,e,a,s){var i,n={},o=a!==c?a:1,r=s!==c?s:1,l=o+r*(1-o);for(i in t)n[i]=(t[i]*o+e[i]*r*(1-o))/l;return n.a=l,n}function r(t,e,a){return a<t?a:t<e?e:t}function e(t){this.colors={RND:{}},this.options={color:"rgba(0,0,0,0)",grey:l,luminance:d,valueRanges:_};var e,a=this,s=t||{},i=a.options;for(e in u(a),s)s[e]!==c&&(i[e]=s[e]);t=i.customBG,i.customBG="string"==typeof t?k.txt2color(t).rgb:t,B=n(a.colors,i.color,c,!0)}var _={rgb:{r:[0,255],g:[0,255],b:[0,255]},hsv:{h:[0,360],s:[0,100],v:[0,100]},hsl:{h:[0,360],s:[0,100],l:[0,100]},alpha:{alpha:[0,1]},HEX:{HEX:[0,16777215]}},y=t.Math,x=y.round,w={},B={},l={r:.298954,g:.586434,b:.114612},d={r:.2126,g:.7152,b:.0722},u=function(t){w!==t&&(B=(w=t).colors)},k=(e.prototype.setColor=function(t,e,a){return u(this),t?n(this.colors,t,e,c,a):(a!==c&&(this.colors.alpha=r(a,0,1)),o(e))},e.prototype.setCustomBackground=function(t){return u(this),this.options.customBG="string"==typeof t?k.txt2color(t).rgb:t,n(this.colors,c,"rgb")},e.prototype.saveAsBackground=function(){return u(this),n(this.colors,c,"rgb",!0)},e.prototype.toString=function(t,e){return k.color2text((t||"rgb").toLowerCase(),this.colors,e)},{txt2color:function(t){var e,a={},t=t.replace(/(?:#|\)|%)/g,"").split("("),s=(t[1]||"").split(/,\s*/),i=t[1]?t[0].substr(0,3):"rgb";if(a.type=i,a[i]={},t[1])for(var n=3;n--;)e=i[n]||i.charAt(n),a[i][e]=+s[n]/_[i][e][1];else a.rgb=k.HEX2rgb(t[0]);return a.alpha=s[3]?+s[3]:1,a},color2text:function(t,e,a){var s=!1!==a&&x(100*e.alpha)/100,a="number"==typeof s&&!1!==a&&(a||1!==s),i=e.RND.rgb,n=e.RND.hsl,o="hex"===t&&a,r="hex"===t&&!o,i="rgb"===t||o?i.r+", "+i.g+", "+i.b:r?"#"+e.HEX:n.h+", "+n.s+"%, "+n.l+"%";return r?i:(o?"rgb":t)+(a?"a":"")+"("+i+(a?", "+s:"")+")"},RGB2HEX:function(t){return((t.r<16?"0":"")+t.r.toString(16)+(t.g<16?"0":"")+t.g.toString(16)+(t.b<16?"0":"")+t.b.toString(16)).toUpperCase()},HEX2rgb:function(t){return{r:("0x"+(t=t.split(""))[0]+t[t[3]?1:0])/255,g:("0x"+t[t[3]?2:1]+(t[3]||t[1]))/255,b:("0x"+(t[4]||t[2])+(t[5]||t[2]))/255}},hue2RGB:function(t){var t=6*t,e=~~t%6,t=6==t?0:t-e;return{r:x(255*[1,1-t,0,0,t,1][e]),g:x(255*[t,1,1,1-t,0,0][e]),b:x(255*[0,0,t,1,1,1-t][e])}},rgb2hsv:function(t){var e,a=t.r,s=t.g,t=t.b,i=0;return s<t&&(s=t+(t=s,0),i=-1),e=t,a<s&&(a=s+(s=a,0),i=-2/6-i,e=y.min(s,t)),e=a-e,{h:(a?e/a:0)<1e-15?B&&B.hsl&&B.hsl.h||0:e?y.abs(i+(s-t)/(6*e)):0,s:a?e/a:B&&B.hsv&&B.hsv.s||0,v:a}},hsv2rgb:function(t){var e=6*t.h,a=t.s,t=t.v,s=~~e,e=e-s,i=t*(1-a),n=t*(1-e*a),e=t*(1-(1-e)*a),a=s%6;return{r:[t,n,i,i,e,t][a],g:[e,t,t,n,i,i][a],b:[i,i,e,t,t,n][a]}},hsv2hsl:function(t){var e=(2-t.s)*t.v,a=t.s*t.v,a=t.s?e<1?e?a/e:0:a/(2-e):0;return{h:t.h,s:t.v||a?a:B&&B.hsl&&B.hsl.s||0,l:e/2}},rgb2hsl:function(t,e){t=k.rgb2hsv(t);return k.hsv2hsl(e?t:B.hsv=t)},hsl2rgb:function(t){var e=6*t.h,a=t.s,t=t.l,a=t<.5?t*(1+a):t+a-a*t,t=t+t-a,s=~~e,e=a*(a?(a-t)/a:0)*(e-s),i=t+e,e=a-e,s=s%6;return{r:[a,e,t,t,i,a][s],g:[i,a,a,e,t,t][s],b:[t,t,i,a,a,e][s]}}});return e}),function(a,s){"object"==typeof exports?module.exports=s(a,require("jquery"),require("colors")):"function"==typeof define&&define.amd?define(["jquery","colors"],function(t,e){return s(a,t,e)}):s(a,a.jQuery,a.Colors)}(this,function(n,o,e,f){function r(t){return t.value||t.getAttribute("value")||o(t).css("background-color")||"#FFF"}function a(t){return(t=t.originalEvent&&t.originalEvent.touches?t.originalEvent.touches[0]:t).originalEvent?t.originalEvent:t}function l(t){return o(t.find(m.doRender)[0]||t[0])}function i(t){var e=o(this),a=e.offset(),s=o(n),i=m.gap;t?((S=l(e))._colorMode=S.data("colorMode"),g.$trigger=e,(_||(o("head")[m.cssPrepend?"prepend":"append"]('<style type="text/css" id="tinyColorPickerStyles">'+(m.css||".cp-color-picker{position:absolute;overflow:hidden;padding:6px 6px 0;background-color:#444;color:#bbb;font-family:Arial,Helvetica,sans-serif;font-size: var(--chat-text-size-8);font-weight:400;cursor:default;border-radius:5px}.cp-color-picker>div{position:relative;overflow:hidden}.cp-xy-slider{float:left;height:128px;width:128px;margin-bottom:6px;background:linear-gradient(to right,#FFF,rgba(255,255,255,0))}.cp-white{height:100%;width:100%;background:linear-gradient(rgba(0,0,0,0),#000)}.cp-xy-cursor{position:absolute;top:0;width:10px;height:10px;margin:-5px;border:1px solid #fff;border-radius:100%;box-sizing:border-box}.cp-z-slider{float:right;margin-left:6px;height:128px;width:20px;background:linear-gradient(red 0,#f0f 17%,#00f 33%,#0ff 50%,#0f0 67%,#ff0 83%,red 100%)}.cp-z-cursor{position:absolute;margin-top:-4px;width:100%;border:4px solid #fff;border-color:transparent #fff;box-sizing:border-box}.cp-alpha{clear:both;width:100%;height:16px;margin:6px 0;background:linear-gradient(to right,#444,rgba(0,0,0,0))}.cp-alpha-cursor{position:absolute;margin-left:-4px;height:100%;border:4px solid #fff;border-color:#fff transparent;box-sizing:border-box}")+(m.cssAddon||"")+"</style>"),o('<div class="cp-color-picker"><div class="cp-z-slider"><div class="cp-z-cursor"></div></div><div class="cp-xy-slider"><div class="cp-white"></div><div class="cp-xy-cursor"></div></div><div class="cp-alpha"><div class="cp-alpha-cursor"></div></div></div>').css({margin:m.margin}).appendTo("body").show(0,function(){g.$UI=_=o(this),I=m.GPU&&_.css("perspective")!==f,y=o(".cp-z-slider",this),x=o(".cp-xy-slider",this),w=o(".cp-xy-cursor",this),B=o(".cp-z-cursor",this),k=o(".cp-alpha",this),C=o(".cp-alpha-cursor",this),m.buildCallback.call(g,_),_.prepend("<div>").children().eq(0).css("width",_.children().eq(0).width()),_._width=this.offsetWidth,_._height=this.offsetHeight}).hide())).css(m.positionCallback.call(g,e)||{left:(_._left=a.left)-(0<(_._left+=_._width-(s.scrollLeft()+s.width()))+i?_._left+i:0),top:(_._top=a.top+e.outerHeight())-(0<(_._top+=_._height-(s.scrollTop()+s.height()))+i?_._top+i:0)}).show(m.animationSpeed,function(){!0!==t&&(k.toggle(!!m.opacity)._width=k.width(),x._width=x.width(),x._height=x.height(),y._height=y.height(),v.setColor(r(S[0])),p(!0))}).off(".tcp").on(F,".cp-xy-slider,.cp-z-slider,.cp-alpha",c)):g.$trigger&&o(_).hide(m.animationSpeed,function(){p(!1),g.$trigger=null}).off(".tcp")}function c(t){var e=this.className.replace(/cp-(.*?)(?:\s*|$)/,"$1").replace("-","_");1<(t.button||t.which)||(t.preventDefault&&t.preventDefault(),t.returnValue=!1,S._offset=o(this).offset(),(e="xy_slider"===e?s:"z_slider"===e?d:u)(t),p(),A.on(L,function(){A.off(".tcp")}).on($,function(t){e(t),p()}))}function s(t){var t=a(t),e=t.pageX-S._offset.left,t=t.pageY-S._offset.top;v.setColor({s:e/x._width*100,v:100-t/x._height*100},"hsv")}function d(t){t=a(t).pageY-S._offset.top;v.setColor({h:360-t/y._height*360},"hsv")}function u(t){t=(a(t).pageX-S._offset.left)/k._width;v.setColor({},"rgb",t)}function p(t){var e=v.colors,a=e.hueRGB,s=(e.RND.rgb,e.RND.hsl,m.dark),i=m.light,n=v.toString(S._colorMode,m.forceAlpha),o=.22<e.HUELuminance?s:i,r=.22<e.rgbaMixBlack.luminance?s:i,l=(1-e.hsv.h)*y._height,c=e.hsv.s*x._width,d=(1-e.hsv.v)*x._height,u=e.alpha*k._width,p=I?"translate3d":"",h=S[0].value,g=S[0].hasAttribute("value")&&""===h&&t!==f;x._css={backgroundColor:"rgb("+a.r+","+a.g+","+a.b+")"},w._css={transform:p+"("+c+"px, "+d+"px, 0)",left:I?"":c,top:I?"":d,borderColor:.22<e.RGBLuminance?s:i},B._css={transform:p+"(0, "+l+"px, 0)",top:I?"":l,borderColor:"transparent "+o},k._css={backgroundColor:"#"+e.HEX},C._css={transform:p+"("+u+"px, 0, 0)",left:I?"":u,borderColor:r+" transparent"},S._css={backgroundColor:g?"":n,color:g?"":.22<e.rgbaMixBGMixCustom.luminance?s:i},S.text=!g&&h!==n?n:"",t!==f?b(t):E(b)}function b(t){x.css(x._css),w.css(w._css),B.css(B._css),k.css(k._css),C.css(C._css),m.doRender&&S.css(S._css),S.text&&S.val(S.text),m.renderCallback.call(g,S,"boolean"==typeof t?t:f)}function h(t){m=(v=this.color=new e(t)).options,g=this}var g,v,m,S,_,y,x,w,B,k,C,A=o(document),T=o(),$="touchmove.tcp mousemove.tcp pointermove.tcp",F="touchstart.tcp mousedown.tcp pointerdown.tcp",L="touchend.tcp mouseup.tcp pointerup.tcp",I=!1,E=n.requestAnimationFrame||n.webkitRequestAnimationFrame||function(t){t()};h.prototype={render:p,toggle:i},o.fn.colorPicker=function(s){function t(){}var e=this;return s=o.extend({animationSpeed:150,GPU:!0,doRender:!0,customBG:"#FFF",opacity:!0,renderCallback:t,buildCallback:t,positionCallback:t,body:document.body,scrollResize:!0,gap:4,dark:"#222",light:"#DDD"},s),!g&&s.scrollResize&&o(n).on("resize.tcp scroll.tcp",function(){g.$trigger&&g.toggle.call(g.$trigger[0],!0)}),T=T.add(this),this.colorPicker=g||new h(s),this.options=s,o(s.body).off(".tcp").on(F,function(t){-1===T.add(_).add(o(_).find(t.target)).index(t.target)&&i()}),this.on("focusin.tcp click.tcp",function(t){g.color.options=o.extend(g.color.options,m=e.options),i.call(this,t)}).on("change.tcp",function(){v.setColor(this.value||"#FFF"),e.colorPicker.render(!0)}).each(function(){var t=r(this),e=t.split("("),a=l(o(this));a.data("colorMode",e[1]?e[0].substr(0,3):"HEX").attr("readonly",m.preventFocus),s.doRender&&a.css({"background-color":t,color:function(){return.22<v.setColor(t).rgbaMixBGMixCustom.luminance?s.dark:s.light}})})},o.fn.colorPicker.destroy=function(){o("*").off(".tcp"),g.toggle(!1),T=o()}}),window.addEventListener("load",function(){initLoadingAnimation()}),document.addEventListener("click",t=>{var e,a;t.target.classList.contains("settings-button")?(a=(e=t.target.closest(".sb-setting")).querySelector(".active")).classList.contains("sb-hide")?(a.classList.remove("sb-hide"),e.querySelector(".input").classList.remove("sb-hide")):(a.classList.add("sb-hide"),e.querySelector(".input").classList.add("sb-hide")):t.target.classList.contains("sb-revert")&&((a=t.target.closest(".sb-setting")).querySelector(".active").classList.add("sb-hide"),a.querySelector(".input").classList.add("sb-hide"))}),window.onclick=function(t){if(!t.target.matches(".cst-btn"))for(var e=document.getElementsByClassName("cstdown-content"),a=0;a<e.length;a++){var s=e[a];s.classList.contains("show")&&s.classList.remove("show")}},document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector(".help-center");const a=document.getElementById("customer-support");t.addEventListener("click",function(){a?fetch("data.php").then(t=>t.text()).then(t=>{var e=a.contentDocument;e.open(),e.write(t),e.close(),a.style.display="block"}).catch(t=>{console.error("Error fetching data:",t)}):console.error("No se encontr el elemento iframe con el id 'customer-support'")})});