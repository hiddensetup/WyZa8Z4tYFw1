function Metatemplate(){this.templateform=!1,this.selectQuery=function(e){return document.querySelector(this.templateform+" "+e)},this.selectQueryAll=function(e){return document.querySelectorAll(this.templateform+" "+e)},this.payload=function(e){let t=[];this.templateform=e;var e=this.selectQuery(""),a=this.selectQuery(".Language").value,n=this.selectQuery(".ImageUrl").value,e=Object.fromEntries(Array.from(e.elements).map(e=>{return[e.name??e.id,e.value]}));return this.selectQueryAll(".Variables input").forEach(e=>{""!==e.value&&t.push(e.value)}),{type:"template",template_name:e.LoadedTemplate,language:a,variables:t,BodyTemplate:this.selectQuery(".BodyTemplate").value,image_url:n}},this.init=function(e){this.templateform=e;var a=this,e=a.selectQuery(".RemVariableButton");this.selectQuery(".TemplateName");this.selectQuery(".AddButton");const l=this.selectQuery(".LoadedTemplate");l.parentElement;const n=this.selectQuery(".Variables .variables");var t=this.selectQuery(".AddVariableButton");const s=this.selectQuery(".BodyTemplate"),r=this.selectQuery(".Language"),i=this.selectQuery(".ImageUrl"),o=this.selectQuery(".Buttons"),u=this.selectQuery(".FooterTemplate"),c=document.createElement("img");c.style.maxWidth="38px",c.style.height="38px",c.style.objectFit="cover",c.style.borderRadius="8px 0px 0px 8px",c.style.border=".8px solid var(--chat-border-color)",c.style.padding="0.58px",i.insertAdjacentElement("beforebegin",c);let p={};l.addEventListener("change",function(){const a=this.value;var e=new XMLHttpRequest;e.onreadystatechange=function(){var e,t;4===this.readyState&&200===this.status&&(e=JSON.parse(this.responseText).data.find(e=>e.name===a))&&(t=(t=e.components.find(e=>"BODY"===e.type))?t.text:"",s.value=t,r.value=e.language,(t=e.components.find(e=>"HEADER"===e.type&&"IMAGE"===e.format))&&t.example&&t.example.header_handle?c.src=t.example.header_handle[0]:c.src="",i.value="",o.innerHTML="",e.components.filter(e=>"BUTTONS"===e.type&&e.buttons).forEach(e=>{e.buttons&&e.buttons.forEach((e,t)=>{var a=document.createElement("p");a.className="api-dynamic-button Button"+t,a.name=`Button${t}Text`,a.textContent=e.text,o.appendChild(a)})}),t=e.components.find(e=>"FOOTER"===e.type),u.textContent=t?t.text:"")},e.open("GET","uploads/meta_templates.json",!0),e.send()}),s.addEventListener("blur",function(e){var t=s.value;for(const n in p){var a=p[n];if(t===a.template)return l.value=n,r.value=a.language,void(u.textContent=a.footer)}}),t.addEventListener("click",function(){var e,t=a.selectQueryAll(".variables input");3<=t.length||((e=document.createElement("input")).setAttribute("style","margin: 2px 2px;"),t=t.length,e.value=`{{${t+1}}}`,n.appendChild(e))}),e.addEventListener("click",function(){var e=a.selectQueryAll(".variables input"),t=e.length;1<t&&(e[e.length-1].remove(),t.value="{{1}}"),SBChat.showResponse("Variable Removed")}),(t=new XMLHttpRequest).onreadystatechange=function(){var e;4===this.readyState&&200===this.status&&(e=JSON.parse(this.responseText).data,l.innerHTML="",e.forEach(e=>{var t=document.createElement("option");t.value=e.name,t.textContent=e.name,l.appendChild(t)}),0<e.length)&&(e=e[0].name,l.value=e,l.dispatchEvent(new Event("change")))},t.open("GET","uploads/meta_templates.json",!0),t.send()}}