function Metatemplate(){this.templateform=!1,this.selectQuery=function(e){return document.querySelector(this.templateform+" "+e)},this.selectQueryAll=function(e){return document.querySelectorAll(this.templateform+" "+e)},this.payload=function(e){let t=[];this.templateform=e;var e=this.selectQuery(""),a=this.selectQuery(".Language").value,e=Object.fromEntries(Array.from(e.elements).map(e=>{return[e.name??e.id,e.value]}));return this.selectQueryAll(".Variables input").forEach(e=>{""!=e.value&&t.push(e.value)}),{type:"template",template_name:e.LoadedTemplate,language:a,variables:t,BodyTemplate:this.selectQuery(".BodyTemplate").value}},this.init=function(e){this.templateform=e;var a=this,e=a.selectQuery(".RemVariableButton");this.selectQuery(".TemplateName");this.selectQuery(".AddButton");const l=a.selectQuery(".LoadedTemplate");l.parentElement;const n=a.selectQuery(".Variables .variables");var t=a.selectQuery(".AddVariableButton");const s=a.selectQuery(".BodyTemplate"),r=a.selectQuery(".Language");let u={};l.addEventListener("change",function(){const a=this.value;var e=new XMLHttpRequest;e.onreadystatechange=function(){var e,t;4===this.readyState&&200===this.status&&(e=JSON.parse(this.responseText).data.find(e=>e.name===a))&&(t=(t=e.components.find(e=>"BODY"===e.type))?t.text:"",s.value=t,r.value=e.language)},e.open("GET","uploads/meta_templates.json",!0),e.send()}),l.addEventListener("change",function(e){var t,a,e=e.target.value;e in u&&(a=(t=u[e]).template,s.value=a,r.value=t.language,localStorage.setItem("selectedTemplate",e))}),s.addEventListener("blur",function(e){var t=s.value;for(const n in u){var a=u[n];if(t===a.template)return l.value=n,r.value=a.language,void localStorage.setItem("selectedTemplate",n)}}),t.addEventListener("click",function(){var e,t=a.selectQueryAll(".variables input");4<=t.length||((e=document.createElement("input")).setAttribute("style","margin: 2px 2px;"),t=t.length,e.value=`{{${t+1}}}`,n.appendChild(e))}),e.addEventListener("click",function(){var e=a.selectQueryAll(".variables input"),t=e.length;1<t&&(e[e.length-1].remove(),t.value="{{1}}"),SBChat.showResponse("Variable Removed")}),(t=new XMLHttpRequest).onreadystatechange=function(){var e;4===this.readyState&&200===this.status&&(e=JSON.parse(this.responseText).data,l.innerHTML="",e.forEach(e=>{var t=document.createElement("option");t.value=e.name,t.textContent=e.name,l.appendChild(t)}),0<e.length)&&(e=e[0].name,l.value=e,l.dispatchEvent(new Event("change")))},t.open("GET","uploads/meta_templates.json",!0),t.send()}}